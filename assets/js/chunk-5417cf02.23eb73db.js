(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5417cf02"],{"01e1":function(e,t,n){var i=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(v){i=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r});var r=n("faa1").EventEmitter,o=n("3fb5"),s=n("d30c"),a=n("8140"),c=5e3;function d(e){if(!e)return{};for(var t in e){var n=e[t];"string"==typeof n&&(e[t]={response:n})}return e}function u(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function p(e,t){i?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function l(e,t,n,s){var l=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var f=d(e.responseMethods);if(t instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after onRequest");s=t,n=void 0,t=void 0}if(t&&t.send instanceof Function){if(n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");s=n,n=t,t=void 0}if(n instanceof Function){if(void 0!=s)throw new SyntaxError("There can't be parameters after onRequest");s=n,n=void 0}if(n&&n.send instanceof Function&&s&&!(s instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},r.call(this),s&&this.on("request",s),i?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var h=t.max_retries||0;function m(e){l.decode(e.data||e)}this.getTransport=function(){return n},this.setTransport=function(e){n&&(n.removeEventListener?n.removeEventListener("message",m):n.removeListener&&n.removeListener("data",m)),e&&(e.addEventListener?e.addEventListener("message",m):e.addListener&&e.addListener("data",m)),n=u(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(n);var b=t.request_timeout||c,g=t.ping_request_timeout||b,y=t.response_timeout||c,E=t.duplicates_timeout||c,S=0,w=new a,O=new a,R=new a,C={};function I(e,t,n){var i={message:e,timeout:setTimeout((function(){O.remove(t,n)}),y)};O.set(i,t,n)}function P(e,t){var n=setTimeout((function(){R.remove(e,t)}),E);R.set(n,e,t)}function k(t,n,r,o,s){p.call(this,t,n),this.getTransport=function(){return s},this.setTransport=function(e){s=u(e)},i||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var a=O.get(r,o);s||l.getTransport()||(i?this.duplicated=Boolean(a):Object.defineProperty(this,"duplicated",{value:Boolean(a)}));var c=f[t];this.pack=e.pack.bind(e,this,r),this.reply=function(t,n,i){if(t instanceof Function||t&&t.send instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after callback");i=t,n=null,t=void 0}else if(n instanceof Function||n&&n.send instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");i=n,n=null}var s;if(i=u(i),a&&clearTimeout(a.timeout),void 0!=o&&(t&&(t.dest=o),n&&(n.dest=o)),t||void 0!=n){if(void 0!=l.peerID&&(t?t.from=l.peerID:n.from=l.peerID),c)if(void 0==c.error&&t)s={error:t};else{var d=t?c.error:c.response;s={method:d,params:t||n}}else s={error:t,result:n};s=e.pack(s,r)}else s=a?a.message:e.pack({result:null},r);return I(s,r,o),i=i||this.getTransport()||l.getTransport(),i?i.send(s):s}}function _(e){var t=C[e];if(t){delete C[e];var n=w.pop(t.id,t.dest);n&&(clearTimeout(n.timeout),P(t.id,t.dest))}}o(k,p),this.cancel=function(e){if(e)return _(e);for(var e in C)_(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(4003,"Cancel request"),this.cancel(),R.forEach(clearTimeout),O.forEach((function(e){clearTimeout(e.timeout)}))},this.encode=function(t,n,i,r,o){if(n instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");o=n,r=void 0,i=void 0,n=void 0}else if(i instanceof Function){if(void 0!=r)throw new SyntaxError("There can't be parameters after callback");o=i,r=void 0,i=void 0}else if(r instanceof Function){if(void 0!=o)throw new SyntaxError("There can't be parameters after callback");o=r,r=void 0}void 0!=l.peerID&&(n=n||{},n.from=l.peerID),void 0!=i&&(n=n||{},n.dest=i);var s={method:t,params:n};if(o){var a=S++,c=0;function d(e,t){l.cancel(s),o(e,t)}s=e.pack(s,a);var p={message:s,callback:d,responseMethods:f[t]||{}},v=u(r);function m(e){var n="ping"===t?g:b;return p.timeout=setTimeout(E,n*Math.pow(2,c++)),C[s]={id:a,dest:i},w.set(p,a,i),e=e||v||l.getTransport(),e?e.send(s):s}function y(e){e=u(e),console.warn(c+" retry for request message:",s);var t=R.pop(a,i);return clearTimeout(t),m(e)}function E(){if(c<h)return y(r);var e=new Error("Request has timed out");e.request=s,e.retry=y,d(e)}return m(r)}return s=e.pack(s),r=r||this.getTransport(),r?r.send(s):s},this.decode=function(t,n){if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(v){return console.debug(v,t)}var i=t.id,r=t.ack,o=t.method,s=t.params||{},a=s.from,c=s.dest;if(void 0==l.peerID||a!=l.peerID){if(void 0==i&&void 0==r){var d=new p(o,s);if(l.emit("request",d))return;return d}if(o){if(void 0==c||c==l.peerID){var f=w.get(r,a);if(f){var h=f.responseMethods;return o==h.error?E(f,s):o==h.response?E(f,null,s):y()}var m=R.get(r,a);if(m)return S(m)}return y()}var b=t.error,g=t.result;if((!b||!b.dest||b.dest==l.peerID)&&(!g||!g.dest||g.dest==l.peerID)){f=w.get(r,a);if(!f){m=R.get(r,a);return m?S(m):console.warn("No callback was defined for this message",t)}E(f,b,g)}}function y(){if(n=u(n)||l.getTransport(),n){var e=O.get(i,a);if(e)return n.send(e.message)}var t=void 0!=i?i:r,c=new k(o,s,t,a,n);if(!l.emit("request",c))return c}function E(e,t,n){e.callback(t,n)}function S(e){console.warn("Response already processed",t),clearTimeout(e),P(r,a)}}}o(l,r),l.RpcNotification=p,e.exports=l;var f=n("498b"),h=n("79ef");l.clients=f,l.clients.transports=h,l.packers=s},"043b":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.NetworkQualityLevelChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"networkQualityLevelChanged")||this;return o.newValue=n,o.oldValue=i,o.connection=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.NetworkQualityLevelChangedEvent=o},"0703":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.StreamPropertyChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o,s){var a=e.call(this,!1,t,"streamPropertyChanged")||this;return a.stream=n,a.changedProperty=i,a.newValue=r,a.oldValue=o,a.reason=s,a}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.StreamPropertyChangedEvent=o},"0cf2":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.Stream=void 0;var r,o=n("ef86"),s=n("6e4e"),a=n("0f3b"),c=n("e649"),d=n("f852"),u=n("7bca"),p=n("1f15"),l=n("0703"),f=n("4edf"),h=n("f66e"),v=n("e237"),m=n("68cb"),b=h.OpenViduLogger.getInstance(),g=function(e){function t(t,n){var i=e.call(this)||this;return i.isSubscribeToRemote=!1,i.isLocalStreamReadyToPublish=!1,i.isLocalStreamPublished=!1,i.publishedOnce=!1,i.publisherStartSpeakingEventEnabled=!1,i.publisherStartSpeakingEventEnabledOnce=!1,i.publisherStopSpeakingEventEnabled=!1,i.publisherStopSpeakingEventEnabledOnce=!1,i.volumeChangeEventEnabled=!1,i.volumeChangeEventEnabledOnce=!1,r=v.PlatformUtils.getInstance(),i.session=t,n.hasOwnProperty("id")?(i.inboundStreamOpts=n,i.streamId=i.inboundStreamOpts.id,i.creationTime=i.inboundStreamOpts.createdAt,i.hasAudio=i.inboundStreamOpts.hasAudio,i.hasVideo=i.inboundStreamOpts.hasVideo,i.hasAudio&&(i.audioActive=i.inboundStreamOpts.audioActive),i.hasVideo&&(i.videoActive=i.inboundStreamOpts.videoActive,i.typeOfVideo=i.inboundStreamOpts.typeOfVideo?i.inboundStreamOpts.typeOfVideo:void 0,i.frameRate=-1===i.inboundStreamOpts.frameRate?void 0:i.inboundStreamOpts.frameRate,i.videoDimensions=i.inboundStreamOpts.videoDimensions),i.inboundStreamOpts.filter&&Object.keys(i.inboundStreamOpts.filter).length>0&&(i.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(i.inboundStreamOpts.filter.lastExecMethod).length&&delete i.inboundStreamOpts.filter.lastExecMethod,i.filter=i.inboundStreamOpts.filter)):(i.outboundStreamOpts=n,i.hasAudio=i.isSendAudio(),i.hasVideo=i.isSendVideo(),i.hasAudio&&(i.audioActive=!!i.outboundStreamOpts.publisherProperties.publishAudio),i.hasVideo&&(i.videoActive=!!i.outboundStreamOpts.publisherProperties.publishVideo,i.frameRate=i.outboundStreamOpts.publisherProperties.frameRate,"undefined"!==typeof MediaStreamTrack&&i.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?i.typeOfVideo="CUSTOM":i.typeOfVideo=i.isSendScreen()?"SCREEN":"CAMERA"),i.outboundStreamOpts.publisherProperties.filter&&(i.filter=i.outboundStreamOpts.publisherProperties.filter)),i.ee.on("mediastream-updated",(function(){i.streamManager.updateMediaStream(i.mediaStream),b.debug("Video srcObject ["+i.mediaStream+"] updated in stream ["+i.streamId+"]")})),i}return i(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by stream '"+this.streamId+"'",n),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by stream '"+this.streamId+"'",n),this},t.prototype.off=function(t,n){return e.prototype.off.call(this,t,n),this},t.prototype.applyFilter=function(e,t){var n=this;return new Promise((function(i,r){b.info("Applying filter to stream "+n.streamId),t=t||{},"string"!==typeof t&&(t=JSON.stringify(t)),n.session.openvidu.sendRequest("applyFilter",{streamId:n.streamId,type:e,options:t},(function(s,a){if(s)b.error("Error applying filter for Stream "+n.streamId,s),401===s.code?r(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):r(s);else{b.info("Filter successfully applied on Stream "+n.streamId);var c=n.filter;n.filter=new o.Filter(e,t),n.filter.stream=n,n.session.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(n.session,n,"filter",n.filter,c,"applyFilter")]),n.streamManager.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(n.streamManager,n,"filter",n.filter,c,"applyFilter")]),i(n.filter)}}))}))},t.prototype.removeFilter=function(){var e=this;return new Promise((function(t,n){b.info("Removing filter of stream "+e.streamId),e.session.openvidu.sendRequest("removeFilter",{streamId:e.streamId},(function(i,r){if(i)b.error("Error removing filter for Stream "+e.streamId,i),401===i.code?n(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(i);else{b.info("Filter successfully removed from Stream "+e.streamId);var o=e.filter;delete e.filter,e.session.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(e.session,e,"filter",e.filter,o,"applyFilter")]),e.streamManager.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(e.streamManager,e,"filter",e.filter,o,"applyFilter")]),t()}}))}))},t.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},t.prototype.getMediaStream=function(){return this.mediaStream},t.prototype.setMediaStream=function(e){this.mediaStream=e},t.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},t.prototype.getWebRtcPeer=function(){return this.webRtcPeer},t.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},t.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},t.prototype.subscribe=function(){var e=this;return new Promise((function(t,n){e.initWebRtcPeerReceive(!1).then((function(){t()}))["catch"]((function(e){n(e)}))}))},t.prototype.publish=function(){var e=this;return new Promise((function(t,n){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend(!1).then((function(){t()}))["catch"]((function(e){n(e)})):e.ee.once("stream-ready-to-publish",(function(){e.publish().then((function(){t()}))["catch"]((function(e){n(e)}))}))}))},t.prototype.disposeWebRtcPeer=function(){this.webRtcPeer&&(this.webRtcPeer.dispose(),this.stopWebRtcStats()),b.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"WebRTCPeer from 'Stream' with id ["+this.streamId+"] is now closed")},t.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach((function(e){e.stop()})),this.mediaStream.getVideoTracks().forEach((function(e){e.stop()})),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach((function(e){e.stop()})),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach((function(e){e.stop()})),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),b.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed")},t.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},t.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},t.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},t.prototype.isSendScreen=function(){var e="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return r.isElectron()&&(e="string"===typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&e},t.prototype.enableStartSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabled||(this.publisherStartSpeakingEventEnabled=!0,this.speechEvent.on("speaking",(function(){e.session.emitEvent("publisherStartSpeaking",[new u.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.publisherStartSpeakingEventEnabledOnce=!1})))},t.prototype.enableOnceStartSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabledOnce||(this.publisherStartSpeakingEventEnabledOnce=!0,this.speechEvent.once("speaking",(function(){e.publisherStartSpeakingEventEnabledOnce&&e.session.emitEvent("publisherStartSpeaking",[new u.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.disableStartSpeakingEvent(!0)})))},t.prototype.disableStartSpeakingEvent=function(e){if(this.speechEvent){if(this.publisherStartSpeakingEventEnabledOnce=!1,e){if(this.publisherStartSpeakingEventEnabled)return}else this.publisherStartSpeakingEventEnabled=!1;this.volumeChangeEventEnabled||this.volumeChangeEventEnabledOnce||this.publisherStopSpeakingEventEnabled||this.publisherStopSpeakingEventEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.enableStopSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStopSpeakingEventEnabled||(this.publisherStopSpeakingEventEnabled=!0,this.speechEvent.on("stopped_speaking",(function(){e.session.emitEvent("publisherStopSpeaking",[new u.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.publisherStopSpeakingEventEnabledOnce=!1})))},t.prototype.enableOnceStopSpeakingEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStopSpeakingEventEnabledOnce||(this.publisherStopSpeakingEventEnabledOnce=!0,this.speechEvent.once("stopped_speaking",(function(){e.publisherStopSpeakingEventEnabledOnce&&e.session.emitEvent("publisherStopSpeaking",[new u.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.disableStopSpeakingEvent(!0)})))},t.prototype.disableStopSpeakingEvent=function(e){if(this.speechEvent){if(this.publisherStopSpeakingEventEnabledOnce=!1,e){if(this.publisherStopSpeakingEventEnabled)return}else this.publisherStopSpeakingEventEnabled=!1;this.volumeChangeEventEnabled||this.volumeChangeEventEnabledOnce||this.publisherStartSpeakingEventEnabled||this.publisherStartSpeakingEventEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.enableVolumeChangeEvent=function(e){var t=this;this.setSpeechEventIfNotExists()?this.volumeChangeEventEnabled&&!e||(this.volumeChangeEventEnabled=!0,this.speechEvent.on("volume_change",(function(e){var n=t.speechEvent.oldVolumeValue,i={newValue:e,oldValue:n};t.speechEvent.oldVolumeValue=e,t.streamManager.emitEvent("streamAudioVolumeChange",[new p.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",i)])}))):this.volumeChangeEventEnabled=!0},t.prototype.enableOnceVolumeChangeEvent=function(e){var t=this;this.setSpeechEventIfNotExists()?this.volumeChangeEventEnabledOnce&&!e||(this.volumeChangeEventEnabledOnce=!0,this.speechEvent.once("volume_change",(function(e){var n=t.speechEvent.oldVolumeValue,i={newValue:e,oldValue:n};t.speechEvent.oldVolumeValue=e,t.disableVolumeChangeEvent(!0),t.streamManager.emitEvent("streamAudioVolumeChange",[new p.StreamManagerEvent(t.streamManager,"streamAudioVolumeChange",i)])}))):this.volumeChangeEventEnabledOnce=!0},t.prototype.disableVolumeChangeEvent=function(e){if(this.speechEvent){if(this.volumeChangeEventEnabledOnce=!1,e){if(this.volumeChangeEventEnabled)return}else this.volumeChangeEventEnabled=!1;this.publisherStartSpeakingEventEnabled||this.publisherStartSpeakingEventEnabledOnce||this.publisherStopSpeakingEventEnabled||this.publisherStopSpeakingEventEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},t.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},t.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise((function(t,n){e.webRtcStats.getSelectedIceCandidateInfo().then((function(e){return t(e)}))["catch"]((function(e){return n(e)}))}))},t.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},t.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},t.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return b.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Publisher stream '+this.streamId+"will force a reconnection"),!0;var e=this.getRTCPeerConnection().iceConnectionState;return"disconnected"===e||"failed"===e},t.prototype.setSpeechEventIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var e=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval="number"===typeof e.interval?e.interval:100,e.threshold="number"===typeof e.threshold?e.threshold:-50,this.speechEvent=m(this.mediaStream,e)}return!0}return!1},t.prototype.initWebRtcPeerSend=function(e){var t=this;return new Promise((function(n,i){e||t.initHarkEvents();var r={audio:t.isSendAudio(),video:t.isSendVideo()},o={mediaStream:t.mediaStream,mediaConstraints:r,onicecandidate:t.connection.sendIceCandidate.bind(t.connection),iceServers:t.getIceServersConf(),simulcast:!1},s=function(r){b.debug("Sending SDP offer to publish as "+t.streamId,r);var o,s=e?"reconnectStream":"publishVideo";if(e)o={stream:t.streamId};else{var a="";t.isSendVideo()&&(a="undefined"!==typeof MediaStreamTrack&&t.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":t.isSendScreen()?"SCREEN":"CAMERA"),o={doLoopback:t.displayMyRemote()||!1,hasAudio:t.isSendAudio(),hasVideo:t.isSendVideo(),audioActive:t.audioActive,videoActive:t.videoActive,typeOfVideo:a,frameRate:t.frameRate?t.frameRate:-1,videoDimensions:JSON.stringify(t.videoDimensions),filter:t.outboundStreamOpts.publisherProperties.filter}}o["sdpOffer"]=r,t.session.openvidu.sendRequest(s,o,(function(r,o){r?401===r.code?i(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):i("Error on publishVideo: "+JSON.stringify(r)):t.webRtcPeer.processAnswer(o.sdpAnswer,!1).then((function(){t.streamId=o.id,t.creationTime=o.createdAt,t.isLocalStreamPublished=!0,t.publishedOnce=!0,t.displayMyRemote()&&(t.localMediaStreamWhenSubscribedToRemote=t.mediaStream,t.remotePeerSuccessfullyEstablished()),e?t.ee.emitEvent("stream-reconnected-by-publisher",[]):t.ee.emitEvent("stream-created-by-publisher",[]),t.initWebRtcStats(),b.info("'Publisher' ("+t.streamId+") successfully "+(e?"reconnected":"published")+" to session"),n()}))["catch"]((function(e){i(e)}))}))};e&&t.disposeWebRtcPeer(),t.displayMyRemote()?t.webRtcPeer=new c.WebRtcPeerSendrecv(o):t.webRtcPeer=new c.WebRtcPeerSendonly(o),t.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+t.connection.connectionId),t.webRtcPeer.generateOffer().then((function(e){s(e)}))["catch"]((function(e){i(new Error("(publish) SDP offer error: "+JSON.stringify(e)))}))}))},t.prototype.initWebRtcPeerReceive=function(e){var t=this;return new Promise((function(n,i){var r={audio:t.inboundStreamOpts.hasAudio,video:t.inboundStreamOpts.hasVideo};b.debug("'Session.subscribe(Stream)' called. Constraints of generate SDP offer",r);var o={onicecandidate:t.connection.sendIceCandidate.bind(t.connection),mediaConstraints:r,iceServers:t.getIceServersConf(),simulcast:!1},s=function(r){b.debug("Sending SDP offer to subscribe to "+t.streamId,r);var o=e?"reconnectStream":"receiveVideoFrom",s={sdpOffer:r};s[e?"stream":"sender"]=t.streamId,t.session.openvidu.sendRequest(o,s,(function(r,o){if(r)i(new Error("Error on recvVideoFrom: "+JSON.stringify(r)));else{t.session.isFirstIonicIosSubscriber&&(t.session.isFirstIonicIosSubscriber=!1,setTimeout((function(){t.session.countDownForIonicIosSubscribersActive=!1}),400));var s=t.session.countDownForIonicIosSubscribersActive;t.webRtcPeer.processAnswer(o.sdpAnswer,s).then((function(){b.info("'Subscriber' ("+t.streamId+") successfully "+(e?"reconnected":"subscribed")),t.remotePeerSuccessfullyEstablished(),t.initWebRtcStats(),n()}))["catch"]((function(e){i(e)}))}}))};t.webRtcPeer=new c.WebRtcPeerRecvonly(o),t.webRtcPeer.addIceConnectionStateChangeListener(t.streamId),t.webRtcPeer.generateOffer().then((function(e){s(e)}))["catch"]((function(e){i(new Error("(subscribe) SDP offer error: "+JSON.stringify(e)))}))}))},t.prototype.remotePeerSuccessfullyEstablished=function(){var e;this.mediaStream=new MediaStream;for(var t=0,n=this.webRtcPeer.pc.getReceivers();t<n.length;t++)e=n[t],e.track&&this.mediaStream.addTrack(e.track);if(b.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof s.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var i=!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=i}if(this.mediaStream.getVideoTracks()[0]){i=!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=i}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},t.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.streamManager.remote&&(this.session.startSpeakingEventsEnabled&&this.enableStartSpeakingEvent(),this.session.startSpeakingEventsEnabledOnce&&this.enableOnceStartSpeakingEvent(),this.session.stopSpeakingEventsEnabled&&this.enableStopSpeakingEvent(),this.session.stopSpeakingEventsEnabledOnce&&this.enableOnceStopSpeakingEvent()),this.volumeChangeEventEnabled&&this.enableVolumeChangeEvent(!0),this.volumeChangeEventEnabledOnce&&this.enableOnceVolumeChangeEvent(!0))},t.prototype.initWebRtcStats=function(){this.webRtcStats=new d.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},t.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},t.prototype.getIceServersConf=function(){var e;return e=this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0,e},t.prototype.gatherStatsForPeer=function(){var e=this;return new Promise((function(t,n){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n["type"]=t.type,n["timestamp"]=t.timestamp,n["id"]=t.id,"outbound-rtp"===t.type&&(n["ssrc"]=t.ssrc,n["firCount"]=t.firCount,n["pliCount"]=t.pliCount,n["nackCount"]=t.nackCount,n["qpSum"]=t.qpSum,t.kind?n["mediaType"]=t.kind:t.mediaType?n["mediaType"]=t.mediaType:n["mediaType"]=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n["mediaType"]&&(n["framesEncoded"]=t.framesEncoded),n["packetsSent"]=t.packetsSent,n["bytesSent"]=t.bytesSent),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n["availableOutgoingBitrate"]=t.availableOutgoingBitrate,n["rtt"]=t.currentRoundTripTime,n["averageRtt"]=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,b.log(n)}}))}))})):e.getRTCPeerConnection().getReceivers().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n["type"]=t.type,n["timestamp"]=t.timestamp,n["id"]=t.id,"inbound-rtp"===t.type&&(n["ssrc"]=t.ssrc,n["firCount"]=t.firCount,n["pliCount"]=t.pliCount,n["nackCount"]=t.nackCount,n["qpSum"]=t.qpSum,t.kind?n["mediaType"]=t.kind:t.mediaType?n["mediaType"]=t.mediaType:n["mediaType"]=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n["mediaType"]&&(n["framesDecoded"]=t.framesDecoded),n["packetsReceived"]=t.packetsReceived,n["packetsLost"]=t.packetsLost,n["jitter"]=t.jitter,n["bytesReceived"]=t.bytesReceived),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n["availableIncomingBitrate"]=t.availableIncomingBitrate,n["rtt"]=t.currentRoundTripTime,n["averageRtt"]=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type,b.log(n)}}))}))}))}))},t.prototype.isReportWanted=function(e){return"inbound-rtp"===e.type&&!this.isLocal()||"outbound-rtp"===e.type&&this.isLocal()||"candidate-pair"===e.type&&e.nominated&&e.bytesSent>0},t}(a.EventDispatcher);t.Stream=g},"0f3b":function(e,t,n){"use strict";t.__esModule=!0,t.EventDispatcher=void 0;var i=n("e0ef"),r=n("f66e"),o=r.OpenViduLogger.getInstance(),s=function(){function e(){this.userHandlerArrowHandler=new WeakMap,this.ee=new i}return e.prototype.off=function(e,t){if(t){var n=this.userHandlerArrowHandler.get(t);n&&this.ee.off(e,n),this.userHandlerArrowHandler["delete"](t)}else this.ee.removeAllListeners(e);return this},e.prototype.onAux=function(e,t,n){var i=function(e){e?o.info(t,e):o.info(t),n(e)};return this.userHandlerArrowHandler.set(n,i),this.ee.on(e,i),this},e.prototype.onceAux=function(e,t,n){var i=this,r=function(e){e?o.info(t,e):o.info(t),n(e),i.userHandlerArrowHandler["delete"](n)};return this.userHandlerArrowHandler.set(n,r),this.ee.once(e,r),this},e}();t.EventDispatcher=s},"103a":function(e,t,n){var i=n("01e1"),r=n("714c");Date.now=Date.now||function(){return+new Date};var o=5e3,s="RECONNECTING",a="CONNECTED",c="DISCONNECTED",d=console;function u(e){var t,n=this,u=e.ws,p=-1,l=0,f=!0,h=!1,v=c,m=u.onreconnecting,b=u.onreconnected,g=u.onconnected,y=u.onerror;e.rpc.pull=function(e,t){t.reply(null,"push")},u.onreconnecting=function(){d.debug("--------- ONRECONNECTING -----------"),v!==s?(I(),v=s,m&&m()):d.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},u.onreconnected=function(){d.debug("--------- ONRECONNECTED -----------"),v!==a?(v=a,O(),b&&b()):d.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},u.onconnected=function(){d.debug("--------- ONCONNECTED -----------"),v!==a?(v=a,f=!0,C(),g&&g()):d.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},u.onerror=function(e){d.debug("--------- ONERROR -----------"),v=c,I(),y&&y(e)};var E=new r(u);d.debug("Connecting websocket to URI: "+u.uri);var S={request_timeout:e.rpc.requestTimeout,ping_request_timeout:e.rpc.heartbeatRequestTimeout},w=new i(i.packers.JsonRPC,S,E,(function(t){d.debug("Received request: "+JSON.stringify(t));try{var n=e.rpc[t.method];void 0===n?d.error("Method "+t.method+" not registered in client"):n(t.params,t)}catch(i){d.error("Exception processing request: "+JSON.stringify(t)),d.error(i)}}));function O(){d.debug("notReconnectIfNumLessThan = "+l+" (old="+p+")"),p=l}function R(){if(f){var t=null;0!=l&&l!=p||(t={interval:e.heartbeat||o}),l++,n.send("ping",t,function(e){return function(t,n){t&&(d.debug("Error in ping request #"+e+" ("+t.message+")"),e>p&&(f=!1,O(),d.debug("Server did not respond to ping message #"+e+". Reconnecting... "),E.reconnectWs()))}}(l))}else d.debug("Trying to send ping, but ping is not enabled")}function C(){h||(d.debug("Starting ping (if configured)"),h=!0,void 0!=e.heartbeat&&(t=setInterval(R,e.heartbeat),R()))}function I(){clearInterval(t),h=!1,f=!1,l=-1,w.cancel()}this.send=function(e,t,n){"ping"!==e&&d.debug("Request: method:"+e+" params:"+JSON.stringify(t));var i=Date.now();w.encode(e,t,(function(r,o){if(r){try{d.error("ERROR:"+r.message+" in Request: method:"+e+" params:"+JSON.stringify(t)+" request:"+r.request),r.data&&d.error("ERROR DATA:"+JSON.stringify(r.data))}catch(s){}r.requestTime=i}n&&(void 0!=o&&"pong"!==o.value&&d.debug("Response: "+JSON.stringify(o)),n(r,o))}))},this.close=function(e,n){d.debug("Closing  with code: "+e+" because: "+n),void 0!=t&&(d.debug("Clearing ping interval"),clearInterval(t)),h=!1,f=!1,E.close(e,n)},this.forceClose=function(e){E.forceClose(e)},this.reconnect=function(){E.reconnectWs()},this.resetPing=function(){f=!0,l=0,C()}}e.exports=u},"11c5":function(e,t){var n,i,r="screen";if("undefined"!==typeof window&&"undefined"!==typeof navigator&&"undefined"!==typeof navigator.userAgent){var o="undefined"!==typeof window.InstallTrigger,s=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.addEventListener("message",(function(e){e.origin==window.location.origin&&a(e.data)}))}function a(e){if("PermissionDeniedError"==e){if(i)return i("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(r="desktop"),e.sourceId&&i&&i(n=e.sourceId,!0===e.canRequestAudioTrack)}function c(e){if(e){if("desktop"==r)return e(!0);window.postMessage("are-you-there","*"),setTimeout((function(){e("screen"!=r)}),2e3)}}function d(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);i=e,window.postMessage("get-sourceId","*")}function u(e){if(!e)throw'"callback" parameter is mandatory.';if(n)return e(n);i=e,window.postMessage("audio-plus-tab","*")}function p(e,t){if(o)return t("not-chrome");2!=arguments.length&&(t=e,e="lfcgfepafnobdloecchnfaclibenjold");var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){r="screen",window.postMessage("are-you-there","*"),setTimeout((function(){t("screen"==r?"installed-disabled":"installed-enabled")}),2e3)},n.onerror=function(){t("not-installed")}}function l(e){f(e,!0)}function f(e,t){n="";var i={mozMediaSource:"window",mediaSource:"window"};if(o)return e(null,i);var s={mandatory:{chromeMediaSource:r,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=r||n?("desktop"==r&&(s.mandatory.chromeMediaSourceId=n),e(null,s)):t?u((function(t,n){s.mandatory.chromeMediaSourceId=t,n&&(s.canRequestAudioTrack=!0),e("PermissionDeniedError"==t?t:null,s)})):d((function(t){s.mandatory.chromeMediaSourceId=t,e("PermissionDeniedError"==t?t:null,s)}))}t.getScreenConstraints=f,t.getScreenConstraintsWithAudio=l,t.isChromeExtensionAvailable=c,t.getChromeExtensionStatus=p,t.getSourceId=d},"1f15":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.StreamManagerEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.value=i,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.StreamManagerEvent=o},2533:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return c([e,t])}}function c(o){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};t.__esModule=!0,t.Session=void 0;var s,a=n("af246"),c=n("ef86"),d=n("6e4e"),u=n("0f3b"),p=n("f0a5"),l=n("fa28"),f=n("ad42"),h=n("92c2"),v=n("b2e1"),m=n("4def"),b=n("0703"),g=n("f1bf"),y=n("043b"),E=n("4edf"),S=n("fdd2"),w=n("f66e"),O=n("e237"),R=w.OpenViduLogger.getInstance(),C=function(e){function t(t){var n=e.call(this)||this;return n.streamManagers=[],n.remoteStreamsCreated={},n.isFirstIonicIosSubscriber=!0,n.countDownForIonicIosSubscribersActive=!0,n.remoteConnections={},n.startSpeakingEventsEnabled=!1,n.startSpeakingEventsEnabledOnce=!1,n.stopSpeakingEventsEnabled=!1,n.stopSpeakingEventsEnabledOnce=!1,s=O.PlatformUtils.getInstance(),n.openvidu=t,n}return i(t,e),t.prototype.connect=function(e,t){var n=this;return new Promise((function(i,r){n.processToken(e),n.openvidu.checkSystemRequirements()?(n.options={sessionId:n.sessionId,participantId:e,metadata:t?n.stringClientMetadata(t):""},n.connectAux(e).then((function(){i()}))["catch"]((function(e){r(e)}))):r(new E.OpenViduError(E.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+s.getName()+" (version "+s.getVersion()+") for "+s.getFamily()+" is not supported in OpenVidu"))}))},t.prototype.disconnect=function(){this.leave(!1,"disconnect")},t.prototype.subscribe=function(e,t,n,i){var r,o={};o=n&&"function"!==typeof n?{insertMode:"undefined"!==typeof n.insertMode?"string"===typeof n.insertMode?S.VideoInsertMode[n.insertMode]:o.insertMode:S.VideoInsertMode.APPEND,subscribeToAudio:"undefined"===typeof n.subscribeToAudio||n.subscribeToAudio,subscribeToVideo:"undefined"===typeof n.subscribeToVideo||n.subscribeToVideo}:{insertMode:S.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0},n&&"function"===typeof n?r=n:i&&(r=i),R.info("Subscribing to "+e.connection.connectionId),e.subscribe().then((function(){R.info("Subscribed correctly to "+e.connection.connectionId),void 0!==r&&r(void 0)}))["catch"]((function(e){void 0!==r&&r(e)}));var s=new d.Subscriber(e,t,o);return s.targetElement&&e.streamManager.createVideoElement(s.targetElement,o.insertMode),s},t.prototype.subscribeAsync=function(e,t,n){var i=this;return new Promise((function(r,o){var s,a=function(e){e?o(e):r(s)};s=n?i.subscribe(e,t,n,a):i.subscribe(e,t,a)}))},t.prototype.unsubscribe=function(e){var t=e.stream.connection.connectionId;R.info("Unsubscribing from "+t),this.openvidu.sendRequest("unsubscribeFromVideo",{sender:e.stream.connection.connectionId},(function(n,i){n?R.error("Error unsubscribing from "+t,n):R.info("Unsubscribed correctly from "+t),e.stream.disposeWebRtcPeer(),e.stream.disposeMediaStream()})),e.stream.streamManager.removeAllVideos()},t.prototype.publish=function(e){var t=this;return new Promise((function(n,i){e.session=t,e.stream.session=t,e.stream.publishedOnce?e.initialize().then((function(){t.connection.addStream(e.stream),e.reestablishStreamPlayingEvent(),e.stream.publish().then((function(){t.sendVideoData(e,8,!0,5),n()}))["catch"]((function(e){i(e)}))}))["catch"]((function(e){i(e)})):(t.connection.addStream(e.stream),e.stream.publish().then((function(){t.sendVideoData(e,8,!0,5),n()}))["catch"]((function(e){i(e)})))}))},t.prototype.unpublish=function(e){var t=e.stream;if(t.connection)if(t.connection===this.connection){R.info("Unpublishing local media ("+t.connection.connectionId+")"),this.openvidu.sendRequest("unpublishVideo",(function(e,t){e?R.error(e):R.info("Media unpublished correctly")})),t.disposeWebRtcPeer(),delete t.connection.stream;var n=new m.StreamEvent(!0,e,"streamDestroyed",e.stream,"unpublish");e.emitEvent("streamDestroyed",[n]),n.callDefaultBehavior()}else R.error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method",t);else R.error("The associated Connection object of this Publisher is null",t)},t.prototype.forceDisconnect=function(e){var t=this;return new Promise((function(n,i){R.info("Forcing disconnect for connection "+e.connectionId),t.openvidu.sendRequest("forceDisconnect",{connectionId:e.connectionId},(function(t,r){t?(R.error("Error forcing disconnect for Connection "+e.connectionId,t),401===t.code?i(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):i(t)):(R.info("Forcing disconnect correctly for Connection "+e.connectionId),n())}))}))},t.prototype.forceUnpublish=function(e){var t=this;return new Promise((function(n,i){R.info("Forcing unpublish for stream "+e.streamId),t.openvidu.sendRequest("forceUnpublish",{streamId:e.streamId},(function(t,r){t?(R.error("Error forcing unpublish for Stream "+e.streamId,t),401===t.code?i(new E.OpenViduError(E.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):i(t)):(R.info("Forcing unpublish correctly for Stream "+e.streamId),n())}))}))},t.prototype.signal=function(e){var t=this;return new Promise((function(n,i){var r={};if(e.to&&e.to.length>0){var o=[];e.to.forEach((function(e){e.connectionId&&o.push(e.connectionId)})),r["to"]=o}else r["to"]=[];r["data"]=e.data?e.data:"";var s=e.type?e.type:"signal";s&&"signal:"!==s.substring(0,7)&&(s="signal:"+s),r["type"]=s,t.openvidu.sendRequest("sendMessage",{message:JSON.stringify(r)},(function(e,t){e?i(e):n()}))}))},t.prototype.on=function(t,n){if(e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by 'Session'",n),"publisherStartSpeaking"===t)for(var i in this.startSpeakingEventsEnabled=!0,this.remoteConnections){var r=this.remoteConnections[i].stream;r&&r.hasAudio&&r.enableStartSpeakingEvent()}if("publisherStopSpeaking"===t)for(var i in this.stopSpeakingEventsEnabled=!0,this.remoteConnections){r=this.remoteConnections[i].stream;r&&r.hasAudio&&r.enableStopSpeakingEvent()}return this},t.prototype.once=function(t,n){if(e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by 'Session'",n),"publisherStartSpeaking"===t)for(var i in this.startSpeakingEventsEnabledOnce=!0,this.remoteConnections){var r=this.remoteConnections[i].stream;r&&r.hasAudio&&r.enableOnceStartSpeakingEvent()}if("publisherStopSpeaking"===t)for(var i in this.stopSpeakingEventsEnabledOnce=!0,this.remoteConnections){r=this.remoteConnections[i].stream;r&&r.hasAudio&&r.enableOnceStopSpeakingEvent()}return this},t.prototype.off=function(t,n){if(e.prototype.off.call(this,t,n),"publisherStartSpeaking"===t){var i=this.ee.getListeners(t).length;if(0===i)for(var r in this.startSpeakingEventsEnabled=!1,this.remoteConnections){var o=this.remoteConnections[r].stream;o&&o.disableStartSpeakingEvent(!1)}}if("publisherStopSpeaking"===t){var s=this.ee.getListeners(t).length;if(0===s)for(var r in this.stopSpeakingEventsEnabled=!1,this.remoteConnections){o=this.remoteConnections[r].stream;o&&o.disableStopSpeakingEvent(!1)}}return this},t.prototype.onParticipantJoined=function(e){var t=this;this.getConnection(e.id,"").then((function(t){R.warn("Connection "+e.id+" already exists in connections list")}))["catch"]((function(n){var i=new a.Connection(t,e);t.remoteConnections[e.id]=i,t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",i,"")])}))},t.prototype.onParticipantLeft=function(e){var t=this;this.getRemoteConnection(e.connectionId,"Remote connection "+e.connectionId+" unknown when 'onParticipantLeft'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){if(n.stream){var i=n.stream,r=new m.StreamEvent(!0,t,"streamDestroyed",i,e.reason);t.ee.emitEvent("streamDestroyed",[r]),r.callDefaultBehavior(),delete t.remoteStreamsCreated[i.streamId],0===Object.keys(t.remoteStreamsCreated).length&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0)}delete t.remoteConnections[n.connectionId],t.ee.emitEvent("connectionDestroyed",[new p.ConnectionEvent(!1,t,"connectionDestroyed",n,e.reason)])}))["catch"]((function(e){R.error(e)}))},t.prototype.onParticipantPublished=function(e){var t,n=this,i=function(e){n.remoteConnections[e.connectionId]=e,n.remoteStreamsCreated[e.stream.streamId]||n.ee.emitEvent("streamCreated",[new m.StreamEvent(!1,n,"streamCreated",e.stream,"")]),n.remoteStreamsCreated[e.stream.streamId]=!0};this.getRemoteConnection(e.id,"Remote connection '"+e.id+"' unknown when 'onParticipantPublished'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){t=n,e.metadata=n.data,t.remoteOptions=e,t.initRemoteStreams(e.streams),i(t)}))["catch"]((function(r){t=new a.Connection(n,e),i(t)}))},t.prototype.onParticipantUnpublished=function(e){var t=this;e.connectionId===this.connection.connectionId?this.stopPublisherStream(e.reason):this.getRemoteConnection(e.connectionId,"Remote connection '"+e.connectionId+"' unknown when 'onParticipantUnpublished'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){var i=new m.StreamEvent(!0,t,"streamDestroyed",n.stream,e.reason);t.ee.emitEvent("streamDestroyed",[i]),i.callDefaultBehavior();var r=n.stream.streamId;delete t.remoteStreamsCreated[r],0===Object.keys(t.remoteStreamsCreated).length&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0),n.removeStream(r)}))["catch"]((function(e){R.error(e)}))},t.prototype.onParticipantEvicted=function(e){e.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,e.reason)},t.prototype.onNewMessage=function(e){var t=this;R.info("New signal: "+JSON.stringify(e));var n=e.type?e.type.replace(/^(signal:)/,""):void 0;e.from?this.getConnection(e.from,"Connection '"+e.from+"' unknow when 'onNewMessage'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))+". Existing local connection: "+this.connection.connectionId).then((function(i){t.ee.emitEvent("signal",[new v.SignalEvent(t,n,e.data,i)]),"signal"!==e.type&&t.ee.emitEvent(e.type,[new v.SignalEvent(t,n,e.data,i)])}))["catch"]((function(e){R.error(e)})):(this.ee.emitEvent("signal",[new v.SignalEvent(this,n,e.data,void 0)]),"signal"!==e.type&&this.ee.emitEvent(e.type,[new v.SignalEvent(this,n,e.data,void 0)]))},t.prototype.onStreamPropertyChanged=function(e){var t=this,n=function(n){if(n.stream&&n.stream.streamId===e.streamId){var i=n.stream,r=void 0;switch(e.property){case"audioActive":r=i.audioActive,e.newValue="true"===e.newValue,i.audioActive=e.newValue;break;case"videoActive":r=i.videoActive,e.newValue="true"===e.newValue,i.videoActive=e.newValue;break;case"videoDimensions":r=i.videoDimensions,e.newValue=JSON.parse(JSON.parse(e.newValue)),i.videoDimensions=e.newValue;break;case"filter":r=i.filter,e.newValue=Object.keys(e.newValue).length>0?e.newValue:void 0,void 0!==e.newValue?(i.filter=new c.Filter(e.newValue.type,e.newValue.options),i.filter.stream=i,e.newValue.lastExecMethod&&(i.filter.lastExecMethod=e.newValue.lastExecMethod)):delete i.filter,e.newValue=i.filter;break}t.ee.emitEvent("streamPropertyChanged",[new b.StreamPropertyChangedEvent(t,i,e.property,e.newValue,r,e.reason)]),i.streamManager&&i.streamManager.emitEvent("streamPropertyChanged",[new b.StreamPropertyChangedEvent(i.streamManager,i,e.property,e.newValue,r,e.reason)])}else R.error("No stream with streamId '"+e.streamId+"' found for connection '"+e.connectionId+"' on 'streamPropertyChanged' event")};e.connectionId===this.connection.connectionId?n(this.connection):this.getRemoteConnection(e.connectionId,"Remote connection "+e.connectionId+" unknown when 'onStreamPropertyChanged'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(e){n(e)}))["catch"]((function(e){R.error(e)}))},t.prototype.onConnectionPropertyChanged=function(e){var t;switch(e.property){case"role":t=this.connection.role.slice(),this.connection.role=e.newValue,this.connection.localOptions.role=e.newValue;break;case"record":t=this.connection.record,e.newValue="true"===e.newValue,this.connection.record=e.newValue,this.connection.localOptions.record=e.newValue;break}this.ee.emitEvent("connectionPropertyChanged",[new g.ConnectionPropertyChangedEvent(this,this.connection,e.property,e.newValue,t)])},t.prototype.onNetworkQualityLevelChangedChanged=function(e){var t=this;e.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(this,e.newValue,e.oldValue,this.connection)]):this.getConnection(e.connectionId,"Connection not found for connectionId "+e.connectionId).then((function(n){t.ee.emitEvent("networkQualityLevelChanged",[new y.NetworkQualityLevelChangedEvent(t,e.newValue,e.oldValue,n)])}))["catch"]((function(e){R.error(e)}))},t.prototype.recvIceCandidate=function(e){var t={candidate:e.candidate,component:e.component,foundation:e.foundation,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,tcpType:e.tcpType,usernameFragment:e.usernameFragment,type:e.type,toJSON:function(){return{candidate:e.candidate}}};this.getConnection(e.senderConnectionId,"Connection not found for connectionId "+e.senderConnectionId+" owning endpoint "+e.endpointName+". Ice candidate will be ignored: "+t).then((function(n){var i=n.stream;i.getWebRtcPeer().addIceCandidate(t)["catch"]((function(t){R.error("Error adding candidate for "+i.streamId+" stream of endpoint "+e.endpointName+": "+t)}))}))["catch"]((function(e){R.error(e)}))},t.prototype.onSessionClosed=function(e){R.info("Session closed: "+JSON.stringify(e));var t=e.sessionId;void 0!==t?this.ee.emitEvent("session-closed",[{session:t}]):R.warn("Session undefined on session closed",e)},t.prototype.onLostConnection=function(e){R.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,e)},t.prototype.onRecoveredConnection=function(){R.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},t.prototype.onMediaError=function(e){R.error("Media error: "+JSON.stringify(e));var t=e.error;t?this.ee.emitEvent("error-media",[{error:t}]):R.warn("Received undefined media error. Params:",e)},t.prototype.onRecordingStarted=function(e){this.ee.emitEvent("recordingStarted",[new f.RecordingEvent(this,"recordingStarted",e.id,e.name)])},t.prototype.onRecordingStopped=function(e){this.ee.emitEvent("recordingStopped",[new f.RecordingEvent(this,"recordingStopped",e.id,e.name,e.reason)])},t.prototype.onFilterEventDispatched=function(e){var t=e.connectionId;e.streamId;this.getConnection(t,"No connection found for connectionId "+t).then((function(t){R.info("Filter event dispatched");var n=t.stream;n.filter.handlers[e.eventType](new l.FilterEvent(n.filter,e.eventType,e.data))}))},t.prototype.reconnectBrokenStreams=function(){R.info("Re-establishing media connections...");var e=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(R.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),e=!0);for(var t=0,n=Object.values(this.remoteConnections);t<n.length;t++){var i=n[t];i.stream&&i.stream.streamIceConnectionStateBroken()&&(R.warn("Re-establishing Subscriber "+i.stream.streamId),i.stream.initWebRtcPeerReceive(!0),e=!0)}e||R.info("There were no media streams in need of a reconnection")},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.leave=function(e,t){var n=this;if(e=!!e,R.info("Leaving Session (forced="+e+")"),this.connection){if(this.connection.disposed||e?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",(function(e,t){e&&R.error(e),n.openvidu.closeWs()})),this.stopPublisherStream(t),!this.connection.disposed){var i=new h.SessionDisconnectedEvent(this,t);this.ee.emitEvent("sessionDisconnected",[i]),i.callDefaultBehavior()}}else R.warn("You were not connected to the session "+this.sessionId)},t.prototype.initializeParams=function(e){var t={token:e||"",session:this.sessionId,platform:s.getDescription()?s.getDescription():"unknown",metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder()};return t},t.prototype.sendVideoData=function(e,t,n,i){var a=this;if(void 0===t&&(t=1),void 0===n&&(n=!1),void 0===i&&(i=1),s.isChromeBrowser()||s.isChromeMobileBrowser()||s.isOperaBrowser()||s.isOperaMobileBrowser()||s.isEdgeBrowser()||s.isElectron()||s.isSafariBrowser()&&!s.isIonicIos()||s.isAndroidBrowser()||s.isSamsungBrowser()||s.isIonicAndroid()||s.isIPhoneOrIPad()&&s.isIOSWithSafari()){var c=function(){return r(a,void 0,void 0,(function(){var t,n;return o(this,(function(i){switch(i.label){case 0:return[4,e.stream.getRTCPeerConnection().getStats()];case 1:return t=i.sent(),n=[],t.forEach((function(e){"frameWidth"in e&&"frameHeight"in e&&0===n.length&&n.push(e)})),n.length>0&&this.openvidu.sendRequest("videoData",{height:n[0].frameHeight,width:n[0].frameWidth,videoActive:null!=e.stream.videoActive&&e.stream.videoActive,audioActive:null!=e.stream.audioActive&&e.stream.audioActive},(function(e,t){e&&R.error("Error sending 'videoData' event",e)})),[2]}}))}))};if(n){var d=1;setTimeout((function e(){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,c()];case 1:return n.sent(),d<i&&(d++,setTimeout(e,1e3*t)),[2]}}))}))}),1e3*t)}else setTimeout(c,1e3*t)}else s.isFirefoxBrowser()||s.isFirefoxMobileBrowser()||s.isIonicIos()||s.isReactNative()?this.openvidu.sendRequest("videoData",{height:e.stream.videoDimensions.height,width:e.stream.videoDimensions.width,videoActive:e.stream.videoActive,audioActive:e.stream.audioActive},(function(e,t){e&&R.error("Error sending 'videoData' event",e)})):R.error("Browser "+s.getName()+" (version "+s.getVersion()+") for "+s.getFamily()+" is not supported in OpenVidu for Network Quality")},t.prototype.connectAux=function(e){var t=this;return new Promise((function(n,i){t.openvidu.startWs((function(r){if(r)i(r);else{var o=t.initializeParams(e);t.openvidu.sendRequest("joinRoom",o,(function(e,r){if(e)i(e);else{t.processJoinRoomResponse(r),t.connection=new a.Connection(t,r);var o={connections:new Array,streams:new Array},s=r.value;s.forEach((function(e){var n=new a.Connection(t,e);t.remoteConnections[n.connectionId]=n,o.connections.push(n),n.stream&&(t.remoteStreamsCreated[n.stream.streamId]=!0,o.streams.push(n.stream))})),t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",t.connection,"")]),o.connections.forEach((function(e){t.ee.emitEvent("connectionCreated",[new p.ConnectionEvent(!1,t,"connectionCreated",e,"")])})),o.streams.forEach((function(e){t.ee.emitEvent("streamCreated",[new m.StreamEvent(!1,t,"streamCreated",e,"")])})),n()}}))}}))}))},t.prototype.stopPublisherStream=function(e){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[e]))},t.prototype.stringClientMetadata=function(e){return"string"!==typeof e?JSON.stringify(e):e},t.prototype.getConnection=function(e,t){var n=this;return new Promise((function(i,r){var o=n.remoteConnections[e];o?i(o):n.connection.connectionId===e?i(n.connection):r(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,t))}))},t.prototype.getRemoteConnection=function(e,t){var n=this;return new Promise((function(i,r){var o=n.remoteConnections[e];o?i(o):r(new E.OpenViduError(E.OpenViduErrorName.GENERIC_ERROR,t))}))},t.prototype.processToken=function(e){var t=e.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]},i=e.split("?"),r=decodeURI(i[1]).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var n=t[0],i=t[1];return e[n]=i,e}),{});this.sessionId=r["sessionId"];var o=r["secret"],s=r["recorder"],a=r["webrtcStatsInterval"];o&&(this.openvidu.secret=o),s&&(this.openvidu.recorder=!0),a&&(this.openvidu.webrtcStatsInterval=+a),this.openvidu.wsUri="wss://"+n.host+"/openvidu",this.openvidu.httpUri="https://"+n.host}else R.error('Token "'+e+'" is not valid')},t.prototype.processJoinRoomResponse=function(e){if(this.sessionId=e.session,null!=e.coturnIp&&null!=e.turnUsername&&null!=e.turnCredential){var t="stun:"+e.coturnIp+":3478",n="turn:"+e.coturnIp+":3478",i=n+"?transport=tcp";this.openvidu.iceServers=[{urls:[t]},{urls:[n,i],username:e.turnUsername,credential:e.turnCredential}],R.log("STUN/TURN server IP: "+e.coturnIp),R.log("TURN temp credentials ["+e.turnUsername+":"+e.turnCredential+"]")}this.openvidu.role=e.role,this.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==this.openvidu.role,forceUnpublish:"MODERATOR"===this.openvidu.role,forceDisconnect:"MODERATOR"===this.openvidu.role},R.info("openvidu-server version: "+e.version),e.version!==this.openvidu.libraryVersion&&R.warn("OpenVidu Server ("+e.version+") and OpenVidu Browser ("+this.openvidu.libraryVersion+") versions do NOT match. There may be incompatibilities")},t}(u.EventDispatcher);t.Session=C},"3c4c":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.Publisher=void 0;var r,o=n("2533"),s=n("0cf2"),a=n("3f7b"),c=n("4def"),d=n("0703"),u=n("a081"),p=n("4edf"),l=n("f66e"),f=n("e237"),h=l.OpenViduLogger.getInstance(),v=function(e){function t(t,n,i){var a=e.call(this,new s.Stream(i.session?i.session:new o.Session(i),{publisherProperties:n,mediaConstraints:{}}),t)||this;return a.accessAllowed=!1,a.isSubscribedToRemote=!1,a.accessDenied=!1,r=f.PlatformUtils.getInstance(),a.properties=n,a.openvidu=i,a.stream.ee.on("local-stream-destroyed",(function(e){a.stream.isLocalStreamPublished=!1;var t=new c.StreamEvent(!0,a,"streamDestroyed",a.stream,e);a.emitEvent("streamDestroyed",[t]),t.callDefaultBehavior()})),a}return i(t,e),t.prototype.publishAudio=function(e){var t=this;if(this.stream.audioActive!==e){var n=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();n.getAudioTracks().forEach((function(t){t.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:e,reason:"publishAudio"},(function(n,i){n?h.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t.session,t.stream,"audioActive",e,!e,"publishAudio")]),t.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t,t.stream,"audioActive",e,!e,"publishAudio")]),t.session.sendVideoData(t.stream.streamManager))})),this.stream.audioActive=e,h.info("'Publisher' has "+(e?"published":"unpublished")+" its audio stream")}},t.prototype.publishVideo=function(e){var t=this;if(this.stream.videoActive!==e){var n=this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream();n.getVideoTracks().forEach((function(t){t.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:e,reason:"publishVideo"},(function(n,i){n?h.error("Error sending 'streamPropertyChanged' event",n):(t.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t.session,t.stream,"videoActive",e,!e,"publishVideo")]),t.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t,t.stream,"videoActive",e,!e,"publishVideo")]),t.session.sendVideoData(t.stream.streamManager))})),this.stream.videoActive=e,h.info("'Publisher' has "+(e?"published":"unpublished")+" its video stream")}},t.prototype.subscribeToRemote=function(e){e=void 0===e||e,this.isSubscribedToRemote=e,this.stream.subscribeToMyRemote(e)},t.prototype.on=function(t,n){var i=this;return e.prototype.on.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new c.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new c.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new u.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.once=function(t,n){var i=this;return e.prototype.once.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new c.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new c.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new u.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.replaceTrack=function(e){var t=this,n=function(){var n,i=t.stream.displayMyRemote()?t.stream.localMediaStreamWhenSubscribedToRemote:t.stream.getMediaStream();n="video"===e.kind?i.getVideoTracks()[0]:i.getAudioTracks()[0],i.removeTrack(n),n.stop(),i.addTrack(e),t.session.sendVideoData(t.stream.streamManager,5,!0,5)};return new Promise((function(i,r){if(t.stream.isLocalStreamPublished){var o=t.stream.getRTCPeerConnection().getSenders(),s=void 0;"video"===e.kind?(s=o.find((function(e){return!!e.track&&"video"===e.track.kind})),s||r(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))):"audio"===e.kind?(s=o.find((function(e){return!!e.track&&"audio"===e.track.kind})),s||r(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))):r(new Error("Unknown track kind "+e.kind)),s.replaceTrack(e).then((function(){n(),i()}))["catch"]((function(e){r(e)}))}else n(),i()}))},t.prototype.initialize=function(){var e=this;return new Promise((function(t,n){var i,o={},s={},a=1250,c=function(t){e.accessDenied=!0,e.accessAllowed=!1,n(t)},u=function(n){if(e.accessAllowed=!0,e.accessDenied=!1,"undefined"!==typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&(n.removeTrack(n.getAudioTracks()[0]),n.addTrack(e.properties.audioSource)),"undefined"!==typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&(n.removeTrack(n.getVideoTracks()[0]),n.addTrack(e.properties.videoSource)),n.getAudioTracks()[0]){var i=void 0!==e.stream.audioActive&&null!==e.stream.audioActive?e.stream.audioActive:!!e.stream.outboundStreamOpts.publisherProperties.publishAudio;n.getAudioTracks()[0].enabled=i}if(n.getVideoTracks()[0]){i=void 0!==e.stream.videoActive&&null!==e.stream.videoActive?e.stream.videoActive:!!e.stream.outboundStreamOpts.publisherProperties.publishVideo;n.getVideoTracks()[0].enabled=i}if(e.initializeVideoReference(n),e.stream.displayMyRemote()||e.stream.updateMediaStreamInVideos(),delete e.firstVideoElement,e.stream.isSendVideo())if(e.stream.isSendScreen())e.videoReference.addEventListener("loadedmetadata",(function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.screenShareResizeInterval=setInterval((function(){var t=n.getVideoTracks()[0].getSettings(),i=r.isChromeBrowser()||r.isOperaBrowser()?e.videoReference.videoWidth:t.width,o=r.isChromeBrowser()||r.isOperaBrowser()?e.videoReference.videoHeight:t.height;if(e.stream.isLocalStreamPublished&&(i!==e.stream.videoDimensions.width||o!==e.stream.videoDimensions.height)){var s={width:e.stream.videoDimensions.width,height:e.stream.videoDimensions.height};e.stream.videoDimensions={width:i||0,height:o||0},e.session.openvidu.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:"screenResized"},(function(t,n){t?h.error("Error sending 'streamPropertyChanged' event",t):(e.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e.session,e.stream,"videoDimensions",e.stream.videoDimensions,s,"screenResized")]),e.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,s,"screenResized")]),e.session.sendVideoData(e.stream.streamManager))}))}}),500),e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])}));else if(r.isIonicIos()||r.isSafariBrowser()){e.videoReference.style.display="none",document.body.appendChild(e.videoReference);var o,s=function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]),document.body.removeChild(e.videoReference)};e.videoReference.addEventListener("loadedmetadata",(function(){0===e.videoReference.videoWidth?o=setInterval((function(){0!==e.videoReference.videoWidth&&(clearInterval(o),s())}),40):s()}))}else{var a=e.getVideoDimensions(n),c=a.width,u=a.height;r.isMobileDevice()&&window.innerHeight>window.innerWidth?e.stream.videoDimensions={width:u||0,height:c||0}:e.stream.videoDimensions={width:c||0,height:u||0},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])}else e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]);t()},l=function(t,n){e.clearPermissionDialogTimer(i,a),e.stream.isSendScreen()&&e.stream.isSendAudio()?(s.audio=n,s.video=!1,i=Date.now(),e.setPermissionDialogTimer(a),navigator.mediaDevices.getUserMedia(s).then((function(n){e.clearPermissionDialogTimer(i,a),t.addTrack(n.getAudioTracks()[0]),u(t)}))["catch"]((function(n){e.clearPermissionDialogTimer(i,a),t.getAudioTracks().forEach((function(e){e.stop()})),t.getVideoTracks().forEach((function(e){e.stop()})),c(e.openvidu.generateAudioDeviceError(n,o))}))):u(t)},f=function(t){var n,r;switch(h.error(t),e.clearPermissionDialogTimer(i,a),"Error"===t.name&&(t.name=t.constructor.name),t.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(e){e.stop()})),n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r=t.toString(),c(new p.OpenViduError(n,r))}))["catch"]((function(e){n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,r=t.toString(),c(new p.OpenViduError(n,r))}));break;case"notallowederror":n=e.stream.isSendScreen()?p.OpenViduErrorName.SCREEN_CAPTURE_DENIED:p.OpenViduErrorName.DEVICE_ACCESS_DENIED,r=t.toString(),c(new p.OpenViduError(n,r));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(e){e.stop()})),"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r="Audio input device with deviceId '"+o.audio.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),c(new p.OpenViduError(n,r))}))["catch"]((function(e){"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,r="Video input device with deviceId '"+o.video.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Video input device doesn't support the value passed for constraint '"+t.constraint+"'"),c(new p.OpenViduError(n,r))}));break;case"aborterror":case"notreadableerror":n=p.OpenViduErrorName.DEVICE_ALREADY_IN_USE,r=t.toString(),c(new p.OpenViduError(n,r));break;default:n=p.OpenViduErrorName.GENERIC_ERROR,r=t.toString(),c(new p.OpenViduError(n,r));break}};e.openvidu.generateMediaConstraints(e.properties).then((function(t){var n,c;if(t.videoTrack&&t.audioTrack||t.audioTrack&&!1===(null===(n=t.constraints)||void 0===n?void 0:n.video)||t.videoTrack&&!1===(null===(c=t.constraints)||void 0===c?void 0:c.audio))u(e.openvidu.addAlreadyProvidedTracks(t,new MediaStream));else{o=t.constraints;var d={mediaConstraints:o,publisherProperties:e.properties};e.stream.setOutboundStreamOptions(d);var p=void 0===o.audio||o.audio;s.audio=!e.stream.isSendScreen()&&p,s.video=o.video,i=Date.now(),e.setPermissionDialogTimer(a),e.stream.isSendScreen()&&navigator.mediaDevices["getDisplayMedia"]&&!r.isElectron()?navigator.mediaDevices["getDisplayMedia"]({video:!0}).then((function(n){e.openvidu.addAlreadyProvidedTracks(t,n),l(n,p)}))["catch"]((function(e){f(e)})):navigator.mediaDevices.getUserMedia(s).then((function(n){e.openvidu.addAlreadyProvidedTracks(t,n),l(n,p)}))["catch"]((function(e){f(e)}))}}))["catch"]((function(e){c(e)}))}))},t.prototype.getVideoDimensions=function(e){return e.getVideoTracks()[0].getSettings()},t.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},t.prototype.initializeVideoReference=function(e){this.videoReference=document.createElement("video"),r.isSafariBrowser()&&this.videoReference.setAttribute("playsinline","true"),this.stream.setMediaStream(e),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=e},t.prototype.setPermissionDialogTimer=function(e){var t=this;this.permissionDialogTimeout=setTimeout((function(){t.emitEvent("accessDialogOpened",[])}),e)},t.prototype.clearPermissionDialogTimer=function(e,t){clearTimeout(this.permissionDialogTimeout),Date.now()-e>t&&this.emitEvent("accessDialogClosed",[])},t}(a.StreamManager);t.Publisher=v},"3cf7":function(e,t,n){"use strict";t.__esModule=!0,t.OpenVidu=void 0;var i,r=n("b489"),o=n("3c4c"),s=n("2533"),a=n("92c2"),c=n("0703"),d=n("4edf"),u=n("fdd2"),p=n("f66e"),l=n("e237"),f=n("fb6e"),h=n("11c5"),v=n("e0ef"),m=n("01e1"),b=n("bea1"),g=p.OpenViduLogger.getInstance(),y=function(){function e(){var e=this;this.publishers=[],this.secret="",this.recorder=!1,this.advancedConfiguration={},this.webrtcStatsInterval=0,this.ee=new v,i=l.PlatformUtils.getInstance(),this.libraryVersion=b.version,g.info("'OpenVidu' initialized"),g.info("openvidu-browser version: "+this.libraryVersion),i.isMobileDevice()&&window.addEventListener("orientationchange",(function(){e.publishers.forEach((function(t){if(t.stream.isLocalStreamPublished&&t.stream&&t.stream.hasVideo&&t.stream.streamManager.videos[0])var n=0,r=t.stream.videoDimensions.width,o=t.stream.videoDimensions.height,s=function(){return new Promise((function(e,n){if(i.isIonicIos())e({newWidth:t.stream.streamManager.videos[0].video.videoWidth,newHeight:t.stream.streamManager.videos[0].video.videoHeight});else{var r=t.stream.getMediaStream().getVideoTracks()[0].getSettings(),o=i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?r.width:t.videoReference.videoWidth,s=i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?r.height:t.videoReference.videoHeight;e({newWidth:o,newHeight:s})}}))},a=setInterval((function(){s().then((function(e){d(r,o,e.newWidth,e.newHeight)}))}),75),d=function(i,r,o,s){n++,n>10&&clearTimeout(a),o===i&&s===r||(t.stream.videoDimensions={width:o||0,height:s||0},e.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(t.stream.videoDimensions),reason:"deviceRotated"},(function(n,o){n?g.error("Error sending 'streamPropertyChanged' event",n):(e.session.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(e.session,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:r},"deviceRotated")]),t.emitEvent("streamPropertyChanged",[new c.StreamPropertyChangedEvent(t,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:r},"deviceRotated")]),e.session.sendVideoData(t))})),clearTimeout(a))}}))}))}return e.prototype.initSession=function(){return this.session=new s.Session(this),this.session},e.prototype.initPublisher=function(e,t,n){var i;t&&"function"!==typeof t?(i=t,i={audioSource:"undefined"!==typeof i.audioSource?i.audioSource:void 0,frameRate:"undefined"!==typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:"undefined"!==typeof i.frameRate?i.frameRate:void 0,insertMode:"undefined"!==typeof i.insertMode?"string"===typeof i.insertMode?u.VideoInsertMode[i.insertMode]:i.insertMode:u.VideoInsertMode.APPEND,mirror:"undefined"===typeof i.mirror||i.mirror,publishAudio:"undefined"===typeof i.publishAudio||i.publishAudio,publishVideo:"undefined"===typeof i.publishVideo||i.publishVideo,resolution:"undefined"!==typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:"undefined"!==typeof i.resolution?i.resolution:"640x480",videoSource:"undefined"!==typeof i.videoSource?i.videoSource:void 0,filter:i.filter}):i={insertMode:u.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var r,s=new o.Publisher(e,i,this);return t&&"function"===typeof t?r=t:n&&(r=n),s.initialize().then((function(){void 0!==r&&r(void 0),s.emitEvent("accessAllowed",[])}))["catch"]((function(e){void 0!==r&&r(e),s.emitEvent("accessDenied",[e])})),this.publishers.push(s),s},e.prototype.initPublisherAsync=function(e,t){var n=this;return new Promise((function(i,r){var o,s=function(e){e?r(e):i(o)};o=t?n.initPublisher(e,t,s):n.initPublisher(e,s)}))},e.prototype.initLocalRecorder=function(e){return new r.LocalRecorder(e)},e.prototype.checkSystemRequirements=function(){return i.isIPhoneOrIPad()?i.isIOSWithSafari()||i.isIonicIos()?1:0:i.isChromeBrowser()||i.isChromeMobileBrowser()||i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()||i.isOperaBrowser()||i.isOperaMobileBrowser()||i.isSafariBrowser()||i.isEdgeBrowser()||i.isAndroidBrowser()||i.isElectron()||i.isSamsungBrowser()?1:0},e.prototype.checkScreenSharingCapabilities=function(){return i.canScreenShare()},e.prototype.getDevices=function(){return new Promise((function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){var n,r=[];i.isIonicAndroid()&&"undefined"!=typeof cordova&&(null===(n=null===cordova||void 0===cordova?void 0:cordova.plugins)||void 0===n?void 0:n.EnumerateDevicesPlugin)?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(n){var i=[],o=[],s=[];i=n.filter((function(e){return"audioinput"===e.kind})),o=t.filter((function(e){return"videoinput"===e.kind})),s=t.filter((function(e){return"audioinput"===e.kind})),o.forEach((function(e,t){if(e.label)r.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";n=0===t?"Front Camera":1===t?"Back Camera":"Unknown Camera",r.push({kind:e.kind,deviceId:e.deviceId,label:n})}})),s.forEach((function(e,t){if(e.label)r.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var n="";switch(t){case 0:n="Default";break;case 1:var o=i.filter((function(e){return e.label.includes("Built")}))[0];n=o?o.label:"Built-in Microphone";break;case 2:var s=i.filter((function(e){return e.label.includes("Wired")}))[0];n=s?s.label:"Headset earpiece";break;case 3:var a=i.filter((function(e){return e.label.includes("Bluetooth")}))[0];n=a?a.label:"Wireless";break;default:n="Unknown Microphone";break}r.push({kind:e.kind,deviceId:e.deviceId,label:n})}})),e(r)})):(t.forEach((function(e){"audioinput"!==e.kind&&"videoinput"!==e.kind||r.push({kind:e.kind,deviceId:e.deviceId,label:e.label})})),e(r))}))["catch"]((function(e){g.error("Error getting devices",e),t(e)}))}))},e.prototype.getUserMedia=function(e){var t=this;return new Promise((function(n,r){var o=function(e,i){var o=void 0===i.audio||i.audio,s={audio:o,video:!1};navigator.mediaDevices.getUserMedia(s).then((function(t){e.addTrack(t.getAudioTracks()[0]),n(e)}))["catch"]((function(n){e.getAudioTracks().forEach((function(e){e.stop()})),e.getVideoTracks().forEach((function(e){e.stop()})),r(t.generateAudioDeviceError(n,s))}))};t.generateMediaConstraints(e).then((function(s){var a,c;if(s.videoTrack&&s.audioTrack||s.audioTrack&&!1===(null===(a=s.constraints)||void 0===a?void 0:a.video)||s.videoTrack&&!1===(null===(c=s.constraints)||void 0===c?void 0:c.audio))n(t.addAlreadyProvidedTracks(s,new MediaStream));else{s.videoTrack&&delete s.constraints.video,s.audioTrack&&delete s.constraints.audio;var u=!1;if("string"===typeof e.videoSource&&("screen"===e.videoSource||"window"===e.videoSource||i.isElectron()&&e.videoSource.startsWith("screen:"))&&(u=!s.audioTrack&&null!==e.audioSource&&!1!==e.audioSource,navigator.mediaDevices["getDisplayMedia"]&&!i.isElectron()))return void navigator.mediaDevices["getDisplayMedia"]({video:!0}).then((function(e){t.addAlreadyProvidedTracks(s,e),u?o(e,s.constraints):n(e)}))["catch"]((function(e){var t=d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,n=e.toString();r(new d.OpenViduError(t,n))}));var p=u?{video:s.constraints.video}:s.constraints;navigator.mediaDevices.getUserMedia(p).then((function(e){t.addAlreadyProvidedTracks(s,e),u?o(e,s.constraints):n(e)}))["catch"]((function(t){var n,i=t.toString();n="screen"!==e.videoSource?d.OpenViduErrorName.DEVICE_ACCESS_DENIED:d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,r(new d.OpenViduError(n,i))}))}}))["catch"]((function(e){r(e)}))}))},e.prototype.enableProdMode=function(){g.enableProdMode()},e.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},e.prototype.generateMediaConstraints=function(e){var t=this;return new Promise((function(n,i){var r={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},o=e.audioSource,s=e.videoSource;if(null!==o&&!1!==o||(r.constraints.audio=!1),null!==s&&!1!==s||(r.constraints.video=!1),!1===r.constraints.audio&&!1===r.constraints.video&&i(new d.OpenViduError(d.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")),"undefined"!==typeof MediaStreamTrack&&o instanceof MediaStreamTrack&&(r.audioTrack=o),"undefined"!==typeof MediaStreamTrack&&s instanceof MediaStreamTrack&&(r.videoTrack=s),void 0===o&&(r.constraints.audio=!0),void 0===s&&(r.constraints.video={width:{ideal:640},height:{ideal:480}}),null!==s&&!1!==s){if(e.resolution){var a=e.resolution.toLowerCase().split("x"),c=Number(a[0]),u=Number(a[1]);r.constraints.video={width:{ideal:c},height:{ideal:u}}}e.frameRate&&(r.constraints.video.frameRate={ideal:e.frameRate})}t.configureDeviceIdOrScreensharing(r,e,n,i),n(r)}))},e.prototype.startWs=function(e){var t={heartbeat:5e3,ws:{uri:this.wsUri,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session)}};this.jsonRpcClient=new m.clients.JsonRpcClient(t)},e.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},e.prototype.sendRequest=function(e,t,n){t&&t instanceof Function&&(n=t,t={}),g.debug('Sending request: {method:"'+e+'", params: '+JSON.stringify(t)+"}"),this.jsonRpcClient.send(e,t,n)},e.prototype.getWsUri=function(){return this.wsUri},e.prototype.getSecret=function(){return this.secret},e.prototype.getRecorder=function(){return this.recorder},e.prototype.generateAudioDeviceError=function(e,t){var n,i;switch("Error"===e.name&&(e.name=e.constructor.name),e.name.toLowerCase()){case"notfounderror":return n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i=e.toString(),new d.OpenViduError(n,i);case"notallowederror":return n=d.OpenViduErrorName.DEVICE_ACCESS_DENIED,i=e.toString(),new d.OpenViduError(n,i);case"overconstrainederror":return"deviceid"===e.constraint.toLowerCase()?(n=d.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,i="Audio input device with deviceId '"+t.audio.deviceId.exact+"' not found"):(n=d.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,i="Audio input device doesn't support the value passed for constraint '"+e.constraint+"'"),new d.OpenViduError(n,i);case"notreadableerror":return n=d.OpenViduErrorName.DEVICE_ALREADY_IN_USE,i=e.toString(),new d.OpenViduError(n,i);default:return new d.OpenViduError(d.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,e.toString())}},e.prototype.addAlreadyProvidedTracks=function(e,t){return e.videoTrack&&t.addTrack(e.videoTrack),e.audioTrack&&t.addTrack(e.audioTrack),t},e.prototype.configureDeviceIdOrScreensharing=function(e,t,n,r){var o=this,s=t.audioSource,a=t.videoSource;if("string"===typeof s&&(e.constraints.audio={deviceId:{exact:s}}),"string"===typeof a)if(this.isScreenShare(a))if(this.checkScreenSharingCapabilities())if(i.isElectron()){var c="screen:",u=a,p=u.substr(u.indexOf(c)+c.length);e.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:p}},n(e)}else{if(this.advancedConfiguration.screenShareChromeExtension&&!i.isFirefoxBrowser()&&!i.isFirefoxMobileBrowser()&&!navigator.mediaDevices["getDisplayMedia"])return void h.getScreenConstraints((function(t,i){if(t||i.mandatory&&"screen"===i.mandatory.chromeMediaSource){if("permission-denied"!==t&&"PermissionDeniedError"!==t){var s=o.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();return void h.getChromeExtensionStatus(s,(function(e){if("installed-disabled"===e){var t=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");g.error(t),r(t)}if("not-installed"===e){var n=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,o.advancedConfiguration.screenShareChromeExtension);g.error(n),r(n)}}))}var a=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");g.error(a),r(a)}else e.constraints.video=i,n(e)}));if(!navigator.mediaDevices["getDisplayMedia"]){var l=i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?t.videoSource:void 0;return void f.getScreenId(l,(function(t,i,s){if(t)if("not-installed"===t){var a=o.advancedConfiguration.screenShareChromeExtension?o.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,a);g.error(c),r(c)}else if("installed-disabled"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");g.error(c),r(c)}else if("permission-denied"===t){c=new d.OpenViduError(d.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");g.error(c),r(c)}else{c=new d.OpenViduError(d.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");g.error(c),g.error(t),r(c)}else e.constraints.video=s.video,n(e)}))}n(e)}else{var v=new d.OpenViduError(d.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+i.getName()+" "+i.getVersion());g.error(v),r(v)}else this.setVideoSource(e,a)},e.prototype.setVideoSource=function(e,t){e.constraints.video||(e.constraints.video={}),e.constraints.video["deviceId"]={exact:t}},e.prototype.disconnectCallback=function(){g.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},e.prototype.reconnectingCallback=function(){g.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},e.prototype.reconnectedCallback=function(){var e=this;if(g.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},(function(t,n){t?(g.error(t),g.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"),e.session.onLostConnection("networkDisconnect"),e.jsonRpcClient.close(4101,"Reconnection fault")):(e.jsonRpcClient.resetPing(),e.session.onRecoveredConnection())}));else{g.warn("There was no previous connection when running reconnection callback");var t=new a.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[t]),t.callDefaultBehavior()}else alert("Connection error. Please reload page.")},e.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof s.Session||(g.warn("Session instance not found"),!1)},e.prototype.isScreenShare=function(e){return"screen"===e||"window"===e||i.isElectron()&&e.startsWith("screen:")},e}();t.OpenVidu=y},"3d9c":function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]});t.__esModule=!0,t.EventDispatcher=t.NetworkQualityLevelChangedEvent=t.FilterEvent=t.ConnectionPropertyChangedEvent=t.StreamPropertyChangedEvent=t.VideoElementEvent=t.StreamManagerEvent=t.StreamEvent=t.SignalEvent=t.SessionDisconnectedEvent=t.RecordingEvent=t.PublisherSpeakingEvent=t.ConnectionEvent=t.Event=t.VideoInsertMode=t.OpenViduError=t.LocalRecorderState=t.Filter=t.LocalRecorder=t.Connection=t.Stream=t.StreamManager=t.Subscriber=t.Publisher=t.Session=t.OpenVidu=void 0;var r=n("3cf7");i(t,r,"OpenVidu");var o=n("2533");i(t,o,"Session");var s=n("3c4c");i(t,s,"Publisher");var a=n("6e4e");i(t,a,"Subscriber");var c=n("3f7b");i(t,c,"StreamManager");var d=n("0cf2");i(t,d,"Stream");var u=n("af246");i(t,u,"Connection");var p=n("b489");i(t,p,"LocalRecorder");var l=n("ef86");i(t,l,"Filter");var f=n("627d");i(t,f,"LocalRecorderState");var h=n("4edf");i(t,h,"OpenViduError");var v=n("fdd2");i(t,v,"VideoInsertMode");var m=n("8733");i(t,m,"Event");var b=n("f0a5");i(t,b,"ConnectionEvent");var g=n("7bca");i(t,g,"PublisherSpeakingEvent");var y=n("ad42");i(t,y,"RecordingEvent");var E=n("92c2");i(t,E,"SessionDisconnectedEvent");var S=n("b2e1");i(t,S,"SignalEvent");var w=n("4def");i(t,w,"StreamEvent");var O=n("1f15");i(t,O,"StreamManagerEvent");var R=n("a081");i(t,R,"VideoElementEvent");var C=n("0703");i(t,C,"StreamPropertyChangedEvent");var I=n("f1bf");i(t,I,"ConnectionPropertyChangedEvent");var P=n("fa28");i(t,P,"FilterEvent");var k=n("043b");i(t,k,"NetworkQualityLevelChangedEvent");var _=n("0f3b");i(t,_,"EventDispatcher")},"3f7b":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.StreamManager=void 0;var r,o=n("0f3b"),s=n("1f15"),a=n("a081"),c=n("fdd2"),d=n("f66e"),u=n("e237"),p=d.OpenViduLogger.getInstance(),l=function(e){function t(t,n){var i=e.call(this)||this;if(i.videos=[],i.lazyLaunchVideoElementCreatedEvent=!1,r=u.PlatformUtils.getInstance(),i.stream=t,i.stream.streamManager=i,i.remote=!i.stream.isLocal(),n){var o=void 0;"string"===typeof n?o=document.getElementById(n):n instanceof HTMLElement&&(o=n),o&&(i.firstVideoElement={targetElement:o,video:document.createElement("video"),id:"",canplayListenerAdded:!1},r.isSafariBrowser()&&i.firstVideoElement.video.setAttribute("playsinline","true"),i.targetElement=o,i.element=o)}return i.canPlayListener=function(){i.stream.isLocal()?i.stream.displayMyRemote()?(p.info("Your own remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("remoteVideoPlaying",[new a.VideoElementEvent(i.videos[0].video,i,"remoteVideoPlaying")])):(p.info("Your local 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new a.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])):(p.info("Remote 'Stream' with id ["+i.stream.streamId+"] video is now playing"),i.ee.emitEvent("videoPlaying",[new a.VideoElementEvent(i.videos[0].video,i,"videoPlaying")])),i.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(i,"streamPlaying",void 0)])},i}return i(t,e),t.prototype.on=function(t,n){return e.prototype.onAux.call(this,t,"Event '"+t+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new a.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===t&&this.stream.hasAudio&&this.stream.enableVolumeChangeEvent(!1),this},t.prototype.once=function(t,n){return e.prototype.onceAux.call(this,t,"Event '"+t+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",n),"videoElementCreated"===t&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"!==t&&"videoPlaying"!==t||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new s.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new a.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===t&&this.stream.hasAudio&&this.stream.enableOnceVolumeChangeEvent(!1),this},t.prototype.off=function(t,n){if(e.prototype.off.call(this,t,n),"streamAudioVolumeChange"===t){var i=this.ee.getListeners(t).length;0===i&&this.stream.disableVolumeChangeEvent(!1)}return this},t.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),this.stream.isLocal()&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var t=0,n=this.videos;t<n.length;t++){var i=n[t];if(i.video===e)return 0}for(var r=1,o=0,s=this.stream.session.streamManagers;o<s.length;o++){var a=s[o];if(a.disassociateVideo(e)){r=-1;break}}return this.stream.session.streamManagers.forEach((function(t){t.disassociateVideo(e)})),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),p.info("New video element associated to ",this),r},t.prototype.createVideoElement=function(e,t){var n;if("string"===typeof e){if(n=document.getElementById(e),!n)throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else{if(!(e instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);n=e}var i=this.createVideo();this.initializeVideoProperties(i);var r=t||c.VideoInsertMode.APPEND;switch(r){case c.VideoInsertMode.AFTER:n.parentNode.insertBefore(i,n.nextSibling);break;case c.VideoInsertMode.APPEND:n.appendChild(i);break;case c.VideoInsertMode.BEFORE:n.parentNode.insertBefore(i,n);break;case c.VideoInsertMode.PREPEND:n.insertBefore(i,n.childNodes[0]);break;case c.VideoInsertMode.REPLACE:n.parentNode.replaceChild(i,n);break;default:r=c.VideoInsertMode.APPEND,n.appendChild(i);break}var o={targetElement:n,video:i,insertMode:r,id:i.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(o),this.ee.emitEvent("videoElementCreated",[new a.VideoElementEvent(o.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,i},t.prototype.updatePublisherSpeakingEventsOptions=function(e){var t=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},n="number"===typeof e.interval?e.interval:"number"===typeof t.interval?t.interval:100,i="number"===typeof e.threshold?e.threshold:"number"===typeof t.threshold?t.threshold:-50;this.stream.harkOptions={interval:n,threshold:i},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(n),this.stream.speechEvent.setThreshold(i))},t.prototype.initializeVideoProperties=function(e){this.stream.isLocal()&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,r.isSafariBrowser()&&e.setAttribute("playsinline","true"),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),this.remote||this.stream.displayMyRemote()||(e.muted=!0,"rotateY(180deg)"!==e.style.transform||this.stream.outboundStreamOpts.publisherProperties.mirror?this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e):this.removeMirrorVideo(e))},t.prototype.removeAllVideos=function(){for(var e=this,t=this.stream.session.streamManagers.length-1;t>=0;--t)this.stream.session.streamManagers[t]===this&&this.stream.session.streamManagers.splice(t,1);this.videos.forEach((function(t){t.video&&t.video.removeEventListener&&t.video.removeEventListener("canplay",e.canPlayListener),t.canplayListenerAdded=!1,t.targetElement&&(t.video.parentNode.removeChild(t.video),e.ee.emitEvent("videoElementDestroyed",[new a.VideoElementEvent(t.video,e,"videoElementDestroyed")])),e.removeSrcObject(t),e.videos.filter((function(e){return!e.targetElement}))}))},t.prototype.disassociateVideo=function(e){for(var t=!1,n=0;n<this.videos.length;n++)if(this.videos[n].video===e){this.videos[n].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(n,1),t=!0,p.info("Video element disassociated from ",this);break}return t},t.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},t.prototype.updateMediaStream=function(e){this.videos.forEach((function(t){if(t.video.srcObject=e,r.isIonicIos()){var n=t.video.parentElement,i=t.video;n.replaceChild(i,t.video),t.video=i}}))},t.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},t.prototype.createVideo=function(){return document.createElement("video")},t.prototype.removeSrcObject=function(e){e.video.srcObject=null},t.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},t.prototype.mirrorVideo=function(e){r.isIonicIos()||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},t.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},t}(o.EventDispatcher);t.StreamManager=l},"3fb5":function(e,t){"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},"498b":function(e,t,n){var i=n("103a");t.JsonRpcClient=i},"4def":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.StreamEvent=void 0;var r=n("8733"),o=n("3c4c"),s=n("2533"),a=n("f66e"),c=a.OpenViduLogger.getInstance(),d=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.stream=r,s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof s.Session)c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof o.Publisher){c.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var e=this.target.openvidu.publishers,t=0;t<e.length;t++)if(e[t]===this.target){e.splice(t,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),delete this.stream.session.remoteStreamsCreated[this.stream.streamId];var n=this.stream.session.remoteConnections[this.stream.connection.connectionId];if(n&&n.remoteOptions){var i=n.remoteOptions.streams;for(t=i.length-1;t>=0;--t)i[t].id===this.stream.streamId&&i.splice(t,1)}}},t}(r.Event);t.StreamEvent=d},"4edf":function(e,t,n){"use strict";t.__esModule=!0,t.OpenViduError=t.OpenViduErrorName=void 0,function(e){e["BROWSER_NOT_SUPPORTED"]="BROWSER_NOT_SUPPORTED",e["DEVICE_ACCESS_DENIED"]="DEVICE_ACCESS_DENIED",e["DEVICE_ALREADY_IN_USE"]="DEVICE_ALREADY_IN_USE",e["SCREEN_CAPTURE_DENIED"]="SCREEN_CAPTURE_DENIED",e["SCREEN_SHARING_NOT_SUPPORTED"]="SCREEN_SHARING_NOT_SUPPORTED",e["SCREEN_EXTENSION_NOT_INSTALLED"]="SCREEN_EXTENSION_NOT_INSTALLED",e["SCREEN_EXTENSION_DISABLED"]="SCREEN_EXTENSION_DISABLED",e["INPUT_VIDEO_DEVICE_NOT_FOUND"]="INPUT_VIDEO_DEVICE_NOT_FOUND",e["INPUT_AUDIO_DEVICE_NOT_FOUND"]="INPUT_AUDIO_DEVICE_NOT_FOUND",e["INPUT_AUDIO_DEVICE_GENERIC_ERROR"]="INPUT_AUDIO_DEVICE_GENERIC_ERROR",e["NO_INPUT_SOURCE_SET"]="NO_INPUT_SOURCE_SET",e["PUBLISHER_PROPERTIES_ERROR"]="PUBLISHER_PROPERTIES_ERROR",e["OPENVIDU_PERMISSION_DENIED"]="OPENVIDU_PERMISSION_DENIED",e["OPENVIDU_NOT_CONNECTED"]="OPENVIDU_NOT_CONNECTED",e["GENERIC_ERROR"]="GENERIC_ERROR"}(t.OpenViduErrorName||(t.OpenViduErrorName={}));var i=function(){function e(e,t){this.name=e,this.message=t}return e}();t.OpenViduError=i},"627d":function(e,t,n){"use strict";t.__esModule=!0,t.LocalRecorderState=void 0,function(e){e["READY"]="READY",e["RECORDING"]="RECORDING",e["PAUSED"]="PAUSED",e["FINISHED"]="FINISHED"}(t.LocalRecorderState||(t.LocalRecorderState={}))},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"68cb":function(e,t,n){var i,r=n("a7b3");function o(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,r=t.length;i<r;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}"undefined"!==typeof window&&(i=window.AudioContext||window.webkitAudioContext);var s=null;e.exports=function(e,t){var n=new r;if(!i)return n;t=t||{};var a,c,d,u=t.smoothing||.1,p=t.interval||50,l=t.threshold,f=t.play,h=t.history||10,v=!0;s=t.audioContext||s||new i,d=s.createAnalyser(),d.fftSize=512,d.smoothingTimeConstant=u,c=new Float32Array(d.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=s.createMediaElementSource(e),"undefined"===typeof f&&(f=!0),l=l||-50):(a=s.createMediaStreamSource(e),l=l||-50),a.connect(d),f&&d.connect(s.destination),n.speaking=!1,n.suspend=function(){return s.suspend()},n.resume=function(){return s.resume()},Object.defineProperty(n,"state",{get:function(){return s.state}}),s.onstatechange=function(){n.emit("state_change",s.state)},n.setThreshold=function(e){l=e},n.setInterval=function(e){p=e},n.stop=function(){v=!1,n.emit("volume_change",-100,l),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),d.disconnect(),a.disconnect()},n.speakingHistory=[];for(var m=0;m<h;m++)n.speakingHistory.push(0);var b=function(){setTimeout((function(){if(v){var e=o(d,c);n.emit("volume_change",e,l);var t=0;if(e>l&&!n.speaking){for(var i=n.speakingHistory.length-3;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<l&&n.speaking){for(i=0;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>l)),b()}}),p)};return b(),n}},"6e4e":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.Subscriber=void 0;var r=n("3f7b"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.element=r.targetElement,r.stream=t,r.properties=i,r}return i(t,e),t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach((function(t){t.enabled=e})),this.stream.audioActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its audio stream"),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach((function(t){t.enabled=e})),this.stream.videoActive=e,s.info("'Subscriber' has "+(e?"subscribed to":"unsubscribed from")+" its video stream"),this},t}(r.StreamManager);t.Subscriber=a},"714c":function(e,t,n){"use strict";var i=console,r=2e3,o=3e3,s=3;function a(e){var t,n=!1,a=e.uri,c=!1,d=new WebSocket(a);d.onopen=function(){i.debug("WebSocket connected to "+a),e.onconnected&&e.onconnected()},d.onerror=function(t){i.error("Could not connect to "+a+" (invoking onerror if defined)",t),e.onerror&&e.onerror(t)};var u=function(){d.readyState===s?n?i.debug("Connection closed by user"):(i.debug("Connection closed unexpectecly. Reconnecting..."),p(r,1)):i.debug("Close callback from previous websocket. Ignoring it")};function p(t,n){if(i.debug("reconnect (attempt #"+n+", max="+t+")"),1===n){if(c)return void i.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");c=!0,e.onreconnecting&&e.onreconnecting()}l(t,n)}function l(n,r){i.debug("Reconnection attempt #"+r),d.close(),d=new WebSocket(a),d.onopen=function(){i.debug("Reconnected to "+a+" after "+r+" attempts..."),c=!1,t(),e.onreconnected()&&e.onreconnected(),d.onclose=u},d.onerror=function(t){i.warn("Reconnection error: ",t),r===n?e.ondisconnect&&e.ondisconnect():setTimeout((function(){p(n,r+1)}),o)}}d.onclose=u,this.close=function(){n=!0,d.close()},this.reconnectWs=function(){i.debug("reconnectWs"),p(r,1)},this.send=function(e){d.send(e)},this.addEventListener=function(e,n){t=function(){d.addEventListener(e,n)},t()}}e.exports=a},"75ee":function(e,t){function n(e,t){var n={jsonrpc:"2.0"};if(e.method)n.method=e.method,e.params&&(n.params=e.params),void 0!=t&&(n.id=t);else if(void 0!=t){if(e.error){if(void 0!==e.result)throw new TypeError("Both result and error are defined");n.error=e.error}else{if(void 0===e.result)throw new TypeError("No result or error is defined");n.result=e.result}n.id=t}return JSON.stringify(n)}function i(e){var t=e;("string"===typeof e||e instanceof String)&&(t=JSON.parse(e));var n=t.jsonrpc;if("2.0"!==n)throw new TypeError("Invalid JsonRPC version '"+n+"': "+e);if(void 0==t.method){if(void 0==t.id)throw new TypeError("Invalid message: "+e);var i=void 0!==t.result,r=void 0!==t.error;if(i&&r)throw new TypeError("Both result and error are defined: "+e);if(!i&&!r)throw new TypeError("No result or error is defined: "+e);t.ack=t.id,delete t.id}return t}t.pack=n,t.unpack=i},"79ef":function(e,t,n){var i=n("714c");t.WebSocketWithReconnection=i},"7bca":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.PublisherSpeakingEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,n)||this;return o.type=n,o.connection=i,o.streamId=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.PublisherSpeakingEvent=o},8140:function(e,t){function n(){var e={};this.forEach=function(t){for(var n in e){var i=e[n];for(var r in i)t(i[r])}},this.get=function(t,n){var i=e[n];if(void 0!=i)return i[t]},this.remove=function(t,n){var i=e[n];if(void 0!=i){for(var r in delete i[t],i)return!1;delete e[n]}},this.set=function(t,n,i){if(void 0==t)return this.remove(n,i);var r=e[i];void 0==r&&(e[i]=r={}),r[n]=t}}n.prototype.pop=function(e,t){var n=this.get(e,t);if(void 0!=n)return this.remove(e,t),n},e.exports=n},8733:function(e,t,n){"use strict";t.__esModule=!0,t.Event=void 0;var i=function(){function e(e,t,n){this.hasBeenPrevented=!1,this.cancelable=e,this.target=t,this.type=n}return e.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},e.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},e}();t.Event=i},"92c2":function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.SessionDisconnectedEvent=void 0;var r=n("8733"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(e){function t(t,n){var i=e.call(this,!0,t,"sessionDisconnected")||this;return i.reason=n,i}return i(t,e),t.prototype.callDefaultBehavior=function(){s.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var e=this.target;for(var t in e.remoteConnections)e.remoteConnections[t].stream&&(e.remoteConnections[t].stream.disposeWebRtcPeer(),e.remoteConnections[t].stream.disposeMediaStream(),e.remoteConnections[t].stream.streamManager&&e.remoteConnections[t].stream.streamManager.removeAllVideos(),delete e.remoteStreamsCreated[e.remoteConnections[t].stream.streamId],e.remoteConnections[t].dispose()),delete e.remoteConnections[t]},t}(r.Event);t.SessionDisconnectedEvent=a},a081:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.VideoElementEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,n,i)||this;return r.element=t,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.VideoElementEvent=o},a21b:function(e,t){var n=["stun:","turn:"];e.exports=function(e){var t,i,r=(e||{}).url||e,o={};return"string"==typeof r||r instanceof String?(r=r.trim(),t=n[n.indexOf(r.slice(0,5))],t?(r=r.slice(5),i=r.split("@"),o.username=e.username,o.credential=e.credential,i.length>1&&(r=i[1],i=i[0].split(":"),o.username=i[0],o.credential=(e||{}).credential||i[1]||""),o.url=t+r,o.urls=[o.url],o):e):e}},a4b2:function(e,t){function n(e){throw new TypeError("Not yet implemented")}function i(e){throw new TypeError("Not yet implemented")}t.pack=n,t.unpack=i},a7b3:function(e,t){function n(){}e.exports=n,n.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var i=3===arguments.length,r=i?arguments[1]:void 0,o=i?arguments[2]:arguments[1];return o._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var i=this,r=3===arguments.length,o=r?arguments[1]:void 0,s=r?arguments[2]:arguments[1];function a(){i.off(e,a),s.apply(this,arguments)}return this.on(e,o,a),this},t.releaseGroup=function(e){var t,n,i,r;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(r=this.callbacks[t],n=0,i=r.length;n<i;n++)r[n]._groupName===e&&(r.splice(n,1),n--,i--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,i=this.callbacks[e];return i?1===arguments.length?(delete this.callbacks[e],this):(n=i.indexOf(t),-1!==n&&(i.splice(n,1),0===i.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,i,r=[].slice.call(arguments,1),o=this.callbacks[e],s=this.getWildcardCallbacks(e);if(o)for(i=o.slice(),t=0,n=i.length;t<n;++t){if(!i[t])break;i[t].apply(this,r)}if(s)for(n=s.length,i=s.slice(),t=0,n=i.length;t<n;++t){if(!i[t])break;i[t].apply(this,[e].concat(r))}return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(i=i.concat(this.callbacks[t]));return i}},n.mixin(n)},ad42:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.RecordingEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,n)||this;return s.id=i,r!==i&&(s.name=r),s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.RecordingEvent=o},af246:function(e,t,n){"use strict";t.__esModule=!0,t.Connection=void 0;var i=n("0cf2"),r=n("f66e"),o=r.OpenViduLogger.getInstance(),s=function(){function e(e,t){this.session=e,this.disposed=!1;var n="'Connection' created ";t.role?(this.localOptions=t,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,n+="(local)"):(this.remoteOptions=t,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),n+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),o.info(n)}return e.prototype.sendIceCandidate=function(e){o.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,e),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},(function(e,t){e&&o.error("Error sending ICE candidate: "+JSON.stringify(e))}))},e.prototype.initRemoteStreams=function(e){var t=this;e.forEach((function(e){var n={id:e.id,createdAt:e.createdAt,connection:t,hasAudio:e.hasAudio,hasVideo:e.hasVideo,audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:e.typeOfVideo,frameRate:e.frameRate,videoDimensions:e.videoDimensions?JSON.parse(e.videoDimensions):void 0,filter:e.filter?e.filter:void 0},r=new i.Stream(t.session,n);t.addStream(r)})),o.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},e.prototype.addStream=function(e){e.connection=this,this.stream=e},e.prototype.removeStream=function(e){delete this.stream},e.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},e}();t.Connection=s},b2e1:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.SignalEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r){var o=e.call(this,!1,t,"signal")||this;return n&&(o.type="signal:"+n),o.data=i,o.from=r,o}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.SignalEvent=o},b489:function(e,t,n){"use strict";t.__esModule=!0,t.LocalRecorder=void 0;var i,r=n("627d"),o=n("f66e"),s=n("e237"),a=o.OpenViduLogger.getInstance(),c=function(){function e(e){this.stream=e,this.chunks=[],i=s.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=r.LocalRecorderState.READY}return e.prototype.record=function(e){var t=this;return new Promise((function(n,i){try{if("undefined"===typeof MediaRecorder)throw a.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(t.state!==r.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+t.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");a.log("Starting local recording of stream '"+t.stream.streamId+"' of connection '"+t.connectionId+"'");var o={};"function"===typeof MediaRecorder.isTypeSupported?e?(MediaRecorder.isTypeSupported(e)||i(new Error('mimeType "'+e+'" is not supported')),o={mimeType:e}):a.log("No mimeType parameter provided. Using default codecs"):a.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"),t.mediaRecorder=new MediaRecorder(t.stream.getMediaStream(),o),t.mediaRecorder.start(10)}catch(s){i(s)}t.mediaRecorder.ondataavailable=function(e){t.chunks.push(e.data)},t.mediaRecorder.onerror=function(e){a.error("MediaRecorder error: ",e)},t.mediaRecorder.onstart=function(){a.log("MediaRecorder started (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onstop=function(){t.onStopDefault()},t.mediaRecorder.onpause=function(){a.log("MediaRecorder paused (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onresume=function(){a.log("MediaRecorder resumed (state="+t.mediaRecorder.state+")")},t.mediaRecorder.onwarning=function(e){a.log("MediaRecorder warning: "+e)},t.state=r.LocalRecorderState.RECORDING,n()}))},e.prototype.stop=function(){var e=this;return new Promise((function(t,n){try{if(e.state===r.LocalRecorderState.READY||e.state===r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' before");e.mediaRecorder.onstop=function(){e.onStopDefault(),t()},e.mediaRecorder.stop()}catch(i){n(i)}}))},e.prototype.pause=function(){var e=this;return new Promise((function(t,n){try{e.state!==r.LocalRecorderState.RECORDING&&n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),e.mediaRecorder.pause(),e.state=r.LocalRecorderState.PAUSED,t()}catch(i){n(i)}}))},e.prototype.resume=function(){var e=this;return new Promise((function(t,n){try{if(e.state!==r.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.pause()' before");e.mediaRecorder.resume(),e.state=r.LocalRecorderState.RECORDING,t()}catch(i){n(i)}}))},e.prototype.preview=function(e){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,i.isSafariBrowser()&&this.videoPreview.setAttribute("playsinline","true"),"string"===typeof e){var t=document.getElementById(e);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=e.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},e.prototype.clean=function(){var e=this,t=function(){delete e.blob,e.chunks=[],delete e.mediaRecorder,e.state=r.LocalRecorderState.READY};this.state===r.LocalRecorderState.RECORDING||this.state===r.LocalRecorderState.PAUSED?this.stop().then((function(){return t()}))["catch"]((function(){return t()})):t()},e.prototype.download=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var e=document.createElement("a");e.style.display="none",document.body.appendChild(e);var t=window.URL.createObjectURL(this.blob);e.href=t,e.download=this.id+".webm",e.click(),window.URL.revokeObjectURL(t),document.body.removeChild(e)},e.prototype.getBlob=function(){if(this.state!==r.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},e.prototype.uploadAsBinary=function(e,t){var n=this;return new Promise((function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"===typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status))},s.send(n.blob)}}))},e.prototype.uploadAsMultipartfile=function(e,t){var n=this;return new Promise((function(i,o){if(n.state!==r.LocalRecorderState.FINISHED)o(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"===typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}var u=new FormData;u.append("file",n.blob,n.id+".webm"),s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?i(s.responseText):o(s.status))},s.send(u)}}))},e.prototype.onStopDefault=function(){a.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=r.LocalRecorderState.FINISHED},e}();t.LocalRecorder=c},bea1:function(e){e.exports=JSON.parse('{"_from":"openvidu-browser@^2.11.0","_id":"openvidu-browser@2.16.2","_inBundle":false,"_integrity":"sha1-lbcvLd/y5XsdY+dW90eFE3smb8g=","_location":"/openvidu-browser","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"openvidu-browser@^2.11.0","name":"openvidu-browser","escapedName":"openvidu-browser","rawSpec":"^2.11.0","saveSpec":null,"fetchSpec":"^2.11.0"},"_requiredBy":["#DEV:/","#USER"],"_resolved":"https://registry.npm.taobao.org/openvidu-browser/download/openvidu-browser-2.16.2.tgz","_shasum":"95b72f2ddff2e57b1d63e756f74785137b266fc8","_spec":"openvidu-browser@^2.11.0","_where":"/Volumes/DATA/github/source-client","author":{"name":"OpenVidu"},"bugs":{"url":"https://github.com/OpenVidu/openvidu/issues"},"bundleDependencies":false,"dependencies":{"freeice":"2.2.2","hark":"1.2.3","platform":"1.3.6","uuid":"8.3.1","wolfy87-eventemitter":"5.2.9"},"deprecated":false,"description":"OpenVidu Browser","devDependencies":{"@types/node":"14.14.7","@types/platform":"1.3.3","browserify":"17.0.0","grunt":"1.3.0","grunt-cli":"1.3.2","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.0.0","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22","terser":"5.3.8","tsify":"5.0.2","tslint":"6.1.3","typedoc":"0.19.2","typescript":"4.0.5"},"homepage":"https://github.com/OpenVidu/openvidu#readme","license":"Apache-2.0","main":"lib/index.js","name":"openvidu-browser","repository":{"type":"git","url":"git://github.com/OpenVidu/openvidu.git"},"scripts":{"browserify":"VERSION=${VERSION:-dev}; cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js","build":"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --lib dom,es5,es2015.promise,scripthost","docs":"./generate-docs.sh"},"types":"lib/index.d.ts","version":"2.16.2"}')},c09e:function(e){e.exports=JSON.parse("[]")},d2ca:function(e,t,n){"use strict";n.r(t),n.d(t,"v1",(function(){return g})),n.d(t,"v3",(function(){return F})),n.d(t,"v4",(function(){return U})),n.d(t,"v5",(function(){return z})),n.d(t,"NIL",(function(){return $})),n.d(t,"version",(function(){return Y})),n.d(t,"validate",(function(){return c})),n.d(t,"stringify",(function(){return h})),n.d(t,"parse",(function(){return E}));var i="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);function o(){if(!i)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"===typeof e&&s.test(e)}for(var c=a,d=[],u=0;u<256;++u)d.push((u+256).toString(16).substr(1));function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!c(n))throw TypeError("Stringified UUID is invalid");return n}var l,f,h=p,v=0,m=0;function b(e,t,n){var i=t&&n||0,r=t||new Array(16);e=e||{};var s=e.node||l,a=void 0!==e.clockseq?e.clockseq:f;if(null==s||null==a){var c=e.random||(e.rng||o)();null==s&&(s=l=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=f=16383&(c[6]<<8|c[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),u=void 0!==e.nsecs?e.nsecs:m+1,p=d-v+(u-m)/1e4;if(p<0&&void 0===e.clockseq&&(a=a+1&16383),(p<0||d>v)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=d,m=u,f=a,d+=122192928e5;var b=(1e4*(268435455&d)+u)%4294967296;r[i++]=b>>>24&255,r[i++]=b>>>16&255,r[i++]=b>>>8&255,r[i++]=255&b;var g=d/4294967296*1e4&268435455;r[i++]=g>>>8&255,r[i++]=255&g,r[i++]=g>>>24&15|16,r[i++]=g>>>16&255,r[i++]=a>>>8|128,r[i++]=255&a;for(var y=0;y<6;++y)r[i+y]=s[y];return t||h(r)}var g=b;function y(e){if(!c(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}var E=y;function S(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}var w="6ba7b810-9dad-11d1-80b4-00c04fd430c8",O="6ba7b811-9dad-11d1-80b4-00c04fd430c8",R=function(e,t,n){function i(e,i,r,o){if("string"===typeof e&&(e=S(e)),"string"===typeof i&&(i=E(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(i),s.set(e,i.length),s=n(s),s[6]=15&s[6]|t,s[8]=63&s[8]|128,r){o=o||0;for(var a=0;a<16;++a)r[o+a]=s[a];return r}return h(s)}try{i.name=e}catch(r){}return i.DNS=w,i.URL=O,i};function C(e){if("string"===typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return I(k(_(e),8*e.length))}function I(e){for(var t=[],n=32*e.length,i="0123456789abcdef",r=0;r<n;r+=8){var o=e[r>>5]>>>r%32&255,s=parseInt(i.charAt(o>>>4&15)+i.charAt(15&o),16);t.push(s)}return t}function P(e){return 14+(e+64>>>9<<4)+1}function k(e,t){e[t>>5]|=128<<t%32,e[P(t)-1]=t;for(var n=1732584193,i=-271733879,r=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=i,d=r,u=o;n=V(n,i,r,o,e[s],7,-680876936),o=V(o,n,i,r,e[s+1],12,-389564586),r=V(r,o,n,i,e[s+2],17,606105819),i=V(i,r,o,n,e[s+3],22,-1044525330),n=V(n,i,r,o,e[s+4],7,-176418897),o=V(o,n,i,r,e[s+5],12,1200080426),r=V(r,o,n,i,e[s+6],17,-1473231341),i=V(i,r,o,n,e[s+7],22,-45705983),n=V(n,i,r,o,e[s+8],7,1770035416),o=V(o,n,i,r,e[s+9],12,-1958414417),r=V(r,o,n,i,e[s+10],17,-42063),i=V(i,r,o,n,e[s+11],22,-1990404162),n=V(n,i,r,o,e[s+12],7,1804603682),o=V(o,n,i,r,e[s+13],12,-40341101),r=V(r,o,n,i,e[s+14],17,-1502002290),i=V(i,r,o,n,e[s+15],22,1236535329),n=N(n,i,r,o,e[s+1],5,-165796510),o=N(o,n,i,r,e[s+6],9,-1069501632),r=N(r,o,n,i,e[s+11],14,643717713),i=N(i,r,o,n,e[s],20,-373897302),n=N(n,i,r,o,e[s+5],5,-701558691),o=N(o,n,i,r,e[s+10],9,38016083),r=N(r,o,n,i,e[s+15],14,-660478335),i=N(i,r,o,n,e[s+4],20,-405537848),n=N(n,i,r,o,e[s+9],5,568446438),o=N(o,n,i,r,e[s+14],9,-1019803690),r=N(r,o,n,i,e[s+3],14,-187363961),i=N(i,r,o,n,e[s+8],20,1163531501),n=N(n,i,r,o,e[s+13],5,-1444681467),o=N(o,n,i,r,e[s+2],9,-51403784),r=N(r,o,n,i,e[s+7],14,1735328473),i=N(i,r,o,n,e[s+12],20,-1926607734),n=A(n,i,r,o,e[s+5],4,-378558),o=A(o,n,i,r,e[s+8],11,-2022574463),r=A(r,o,n,i,e[s+11],16,1839030562),i=A(i,r,o,n,e[s+14],23,-35309556),n=A(n,i,r,o,e[s+1],4,-1530992060),o=A(o,n,i,r,e[s+4],11,1272893353),r=A(r,o,n,i,e[s+7],16,-155497632),i=A(i,r,o,n,e[s+10],23,-1094730640),n=A(n,i,r,o,e[s+13],4,681279174),o=A(o,n,i,r,e[s],11,-358537222),r=A(r,o,n,i,e[s+3],16,-722521979),i=A(i,r,o,n,e[s+6],23,76029189),n=A(n,i,r,o,e[s+9],4,-640364487),o=A(o,n,i,r,e[s+12],11,-421815835),r=A(r,o,n,i,e[s+15],16,530742520),i=A(i,r,o,n,e[s+2],23,-995338651),n=L(n,i,r,o,e[s],6,-198630844),o=L(o,n,i,r,e[s+7],10,1126891415),r=L(r,o,n,i,e[s+14],15,-1416354905),i=L(i,r,o,n,e[s+5],21,-57434055),n=L(n,i,r,o,e[s+12],6,1700485571),o=L(o,n,i,r,e[s+3],10,-1894986606),r=L(r,o,n,i,e[s+10],15,-1051523),i=L(i,r,o,n,e[s+1],21,-2054922799),n=L(n,i,r,o,e[s+8],6,1873313359),o=L(o,n,i,r,e[s+15],10,-30611744),r=L(r,o,n,i,e[s+6],15,-1560198380),i=L(i,r,o,n,e[s+13],21,1309151649),n=L(n,i,r,o,e[s+4],6,-145523070),o=L(o,n,i,r,e[s+11],10,-1120210379),r=L(r,o,n,i,e[s+2],15,718787259),i=L(i,r,o,n,e[s+9],21,-343485551),n=T(n,a),i=T(i,c),r=T(r,d),o=T(o,u)}return[n,i,r,o]}function _(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(P(t)),i=0;i<t;i+=8)n[i>>5]|=(255&e[i/8])<<i%32;return n}function T(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function D(e,t){return e<<t|e>>>32-t}function M(e,t,n,i,r,o){return T(D(T(T(t,e),T(i,o)),r),n)}function V(e,t,n,i,r,o,s){return M(t&n|~t&i,e,t,r,o,s)}function N(e,t,n,i,r,o,s){return M(t&i|n&~i,e,t,r,o,s)}function A(e,t,n,i,r,o,s){return M(t^n^i,e,t,r,o,s)}function L(e,t,n,i,r,o,s){return M(n^(t|~i),e,t,r,o,s)}var x=C,B=R("v3",48,x),F=B;function j(e,t,n){e=e||{};var i=e.random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return h(i)}var U=j;function W(e,t,n,i){switch(e){case 0:return t&n^~t&i;case 1:return t^n^i;case 2:return t&n^t&i^n&i;case 3:return t^n^i}}function H(e,t){return e<<t|e>>>32-t}function q(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var r=0;r<i.length;++r)e.push(i.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,s=Math.ceil(o/16),a=new Array(s),c=0;c<s;++c){for(var d=new Uint32Array(16),u=0;u<16;++u)d[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=d}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var p=0;p<s;++p){for(var l=new Uint32Array(80),f=0;f<16;++f)l[f]=a[p][f];for(var h=16;h<80;++h)l[h]=H(l[h-3]^l[h-8]^l[h-14]^l[h-16],1);for(var v=n[0],m=n[1],b=n[2],g=n[3],y=n[4],E=0;E<80;++E){var S=Math.floor(E/20),w=H(v,5)+W(S,m,b,g)+y+t[S]+l[E]>>>0;y=g,g=b,b=H(m,30)>>>0,m=v,v=w}n[0]=n[0]+v>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+b>>>0,n[3]=n[3]+g>>>0,n[4]=n[4]+y>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}var G=q,J=R("v5",80,G),z=J,$="00000000-0000-0000-0000-000000000000";function X(e){if(!c(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}var Y=X},d30c:function(e,t,n){var i=n("75ee"),r=n("a4b2");t.JsonRPC=i,t.XmlRPC=r},e0ef:function(e,t,n){var i;
/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(t){"use strict";function r(){}var o=r.prototype,s=t.EventEmitter;function a(e,t){var n=e.length;while(n--)if(e[n].listener===t)return n;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}function d(e){return"function"===typeof e||e instanceof RegExp||!(!e||"object"!==typeof e)&&d(e.listener)}o.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp)for(n in t={},i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n]);else t=i[e]||(i[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,t){if(!d(t))throw new TypeError("listener must be a function");var n,i=this.getListenersAsObject(e),r="object"===typeof t;for(n in i)i.hasOwnProperty(n)&&-1===a(i[n],t)&&i[n].push(r?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var n,i,r=this.getListenersAsObject(e);for(i in r)r.hasOwnProperty(i)&&(n=a(r[i],t),-1!==n&&r[i].splice(n,1));return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!==typeof t||t instanceof RegExp){i=n.length;while(i--)o.call(this,t,n[i])}else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"===typeof r?o.call(this,i,r):s.call(this,i,r));return this},o.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var n,i,r,o,s,a=this.getListenersAsObject(e);for(o in a)if(a.hasOwnProperty(o))for(n=a[o].slice(0),r=0;r<n.length;r++)i=n[r],!0===i.once&&this.removeListener(e,i.listener),s=i.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},r.noConflict=function(){return t.EventEmitter=s,r},i=function(){return r}.call(t,n,t,e),void 0===i||(e.exports=i)})("undefined"!==typeof window?window:this||{})},e237:function(e,t,n){"use strict";t.__esModule=!0,t.PlatformUtils=void 0;var i=n("faac"),r=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),e.instance},e.prototype.isChromeBrowser=function(){return"Chrome"===i.name},e.prototype.isSafariBrowser=function(){return"Safari"===i.name},e.prototype.isChromeMobileBrowser=function(){return"Chrome Mobile"===i.name},e.prototype.isFirefoxBrowser=function(){return"Firefox"===i.name},e.prototype.isFirefoxMobileBrowser=function(){return"Firefox Mobile"===i.name},e.prototype.isOperaBrowser=function(){return"Opera"===i.name},e.prototype.isOperaMobileBrowser=function(){return"Opera Mobile"===i.name},e.prototype.isEdgeBrowser=function(){var e=(null===i||void 0===i?void 0:i.version)?parseFloat(i.version):-1;return"Microsoft Edge"===i.name&&e>=80},e.prototype.isAndroidBrowser=function(){return"Android Browser"===i.name},e.prototype.isElectron=function(){return"Electron"===i.name},e.prototype.isSamsungBrowser=function(){return"Samsung Internet Mobile"===i.name||"Samsung Internet"===i.name},e.prototype.isIPhoneOrIPad=function(){var e=i.ua?i.ua:navigator.userAgent,t="ontouchend"in document,n=/\b(\w*Macintosh\w*)\b/.test(e)&&t,r=/\b(\w*iPhone\w*)\b/.test(e)&&/\b(\w*Mobile\w*)\b/.test(e)&&t;return n||r},e.prototype.isIOSWithSafari=function(){var e=i.ua?i.ua:navigator.userAgent;return/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(e)&&!/\b(\w*CriOS\w*)\b/.test(e)&&!/\b(\w*FxiOS\w*)\b/.test(e)},e.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&-1===i.ua.indexOf("Safari")},e.prototype.isIonicAndroid=function(){return"Android"===i.os.family&&"Android Browser"==i.name},e.prototype.isMobileDevice=function(){return"iOS"===i.os.family||"Android"===i.os.family},e.prototype.isReactNative=function(){return!1},e.prototype.canScreenShare=function(){var e=(null===i||void 0===i?void 0:i.version)?parseFloat(i.version):-1;return!this.isMobileDevice()&&(this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&e>=13)},e.prototype.getName=function(){return i.name||""},e.prototype.getVersion=function(){return i.version||""},e.prototype.getFamily=function(){return i.os.family||""},e.prototype.getDescription=function(){return i.description||""},e}();t.PlatformUtils=r},e5b5:function(e){e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},e649:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.WebRtcPeerSendrecv=t.WebRtcPeerSendonly=t.WebRtcPeerRecvonly=t.WebRtcPeer=void 0;var r,o=n("f1f1"),s=n("d2ca"),a=n("f66e"),c=n("e237"),d=a.OpenViduLogger.getInstance(),u=function(){function e(e){var t=this;this.configuration=e,this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],this.candidategatheringdone=!1,r=c.PlatformUtils.getInstance(),this.configuration.iceServers=this.configuration.iceServers&&this.configuration.iceServers.length>0?this.configuration.iceServers:o(),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.id=e.id?e.id:this.generateUniqueId(),this.pc.onicecandidate=function(e){if(e.candidate){var n=e.candidate;n?(t.localCandidatesQueue.push({candidate:n.candidate}),t.candidategatheringdone=!1,t.configuration.onicecandidate(e.candidate)):t.candidategatheringdone||(t.candidategatheringdone=!0)}},this.pc.onsignalingstatechange=function(){if("stable"===t.pc.signalingState)while(t.iceCandidateList.length>0){var e=t.iceCandidateList.shift();t.pc.addIceCandidate(e)}},this.start()}return e.prototype.start=function(){var e=this;return new Promise((function(t,n){if("closed"===e.pc.signalingState&&n('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),e.configuration.mediaStream){for(var i=0,r=e.configuration.mediaStream.getTracks();i<r.length;i++){var o=r[i];e.pc.addTrack(o,e.configuration.mediaStream)}t()}}))},e.prototype.dispose=function(){if(d.debug("Disposing WebRtcPeer"),this.pc){if("closed"===this.pc.signalingState)return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},e.prototype.generateOffer=function(){var e=this;return new Promise((function(t,n){var i,o=!0;e.configuration.mediaConstraints&&(i="boolean"!==typeof e.configuration.mediaConstraints.audio||e.configuration.mediaConstraints.audio,o="boolean"!==typeof e.configuration.mediaConstraints.video||e.configuration.mediaConstraints.video);var s={offerToReceiveAudio:"sendonly"!==e.configuration.mode&&i,offerToReceiveVideo:"sendonly"!==e.configuration.mode&&o};d.debug("RTCPeerConnection constraints: "+JSON.stringify(s)),r.isSafariBrowser()&&!r.isIonicIos()?(i&&e.pc.addTransceiver("audio",{direction:e.configuration.mode}),o&&e.pc.addTransceiver("video",{direction:e.configuration.mode}),e.pc.createOffer().then((function(t){return d.debug("Created SDP offer"),e.pc.setLocalDescription(t)})).then((function(){var i=e.pc.localDescription;i?(d.debug("Local description set",i.sdp),t(i.sdp)):n("Local description is not defined")}))["catch"]((function(e){return n(e)}))):e.pc.createOffer(s).then((function(t){return d.debug("Created SDP offer"),e.pc.setLocalDescription(t)})).then((function(){var i=e.pc.localDescription;i?(d.debug("Local description set",i.sdp),t(i.sdp)):n("Local description is not defined")}))["catch"]((function(e){return n(e)}))}))},e.prototype.processAnswer=function(e,t){var n=this;return new Promise((function(i,r){var o={type:"answer",sdp:e};d.debug("SDP answer received, setting remote description"),"closed"===n.pc.signalingState&&r("RTCPeerConnection is closed"),n.setRemoteDescription(o,t,i,r)}))},e.prototype.setRemoteDescription=function(e,t,n,i){var o=this;r.isIonicIos()?t?setTimeout((function(){d.info("setRemoteDescription run after timeout for Ionic iOS device"),o.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){return n()}))["catch"]((function(e){return i(e)}))}),250):this.pc.setRemoteDescription(new RTCSessionDescription(e)).then((function(){return n()}))["catch"]((function(e){return i(e)})):this.pc.setRemoteDescription(e).then((function(){return n()}))["catch"]((function(e){return i(e)}))},e.prototype.addIceCandidate=function(e){var t=this;return new Promise((function(n,i){switch(d.debug("Remote ICE candidate received",e),t.remoteCandidatesQueue.push(e),t.pc.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":t.pc.remoteDescription?t.pc.addIceCandidate(e).then((function(){return n()}))["catch"]((function(e){return i(e)})):(t.iceCandidateList.push(e),n());break;default:t.iceCandidateList.push(e),n()}}))},e.prototype.addIceConnectionStateChangeListener=function(e){var t=this;this.pc.oniceconnectionstatechange=function(){var n=t.pc.iceConnectionState;switch(n){case"disconnected":d.warn("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "disconnected". Possible network disconnection');break;case"failed":d.error("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') to "failed"');break;case"closed":d.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "closed"');break;case"new":d.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "new"');break;case"checking":d.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "checking"');break;case"connected":d.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "connected"');break;case"completed":d.log("IceConnectionState of RTCPeerConnection "+t.id+" ("+e+') change to "completed"');break}}},e.prototype.generateUniqueId=function(){return s.v4()},e}();t.WebRtcPeer=u;var p=function(e){function t(t){var n=this;return t.mode="recvonly",n=e.call(this,t)||this,n}return i(t,e),t}(u);t.WebRtcPeerRecvonly=p;var l=function(e){function t(t){var n=this;return t.mode="sendonly",n=e.call(this,t)||this,n}return i(t,e),t}(u);t.WebRtcPeerSendonly=l;var f=function(e){function t(t){var n=this;return t.mode="sendrecv",n=e.call(this,t)||this,n}return i(t,e),t}(u);t.WebRtcPeerSendrecv=f},ef86:function(e,t,n){"use strict";t.__esModule=!0,t.Filter=void 0;var i=n("0703"),r=n("4edf"),o=n("f66e"),s=o.OpenViduLogger.getInstance(),a=function(){function e(e,t){this.handlers={},this.type=e,this.options=t}return e.prototype.execMethod=function(e,t){var n=this;return new Promise((function(o,a){var c;if(s.info("Executing filter method to stream "+n.stream.streamId),"string"!==typeof t)try{c=JSON.stringify(t)}catch(u){var d="'params' property must be a JSON formatted object";s.error(d),a(d)}else c=t;n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:e,params:c},(function(t,d){if(t)s.error("Error executing filter method for Stream "+n.stream.streamId,t),401===t.code?a(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):a(t);else{s.info("Filter method successfully executed on Stream "+n.stream.streamId);var u=Object.assign({},n.stream.filter);n.stream.filter.lastExecMethod={method:e,params:JSON.parse(c)},n.stream.session.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,u,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,u,"execFilterMethod")]),o()}}))}))},e.prototype.addEventListener=function(e,t){var n=this;return new Promise((function(i,o){s.info("Adding filter event listener to event "+e+" to stream "+n.stream.streamId),n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:e},(function(a,c){a?(s.error("Error adding filter event listener to event "+e+"for Stream "+n.stream.streamId,a),401===a.code?o(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):o(a)):(n.handlers[e]=t,s.info("Filter event listener to event "+e+" successfully applied on Stream "+n.stream.streamId),i())}))}))},e.prototype.removeEventListener=function(e){var t=this;return new Promise((function(n,i){s.info("Removing filter event listener to event "+e+" to stream "+t.stream.streamId),t.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:t.stream.streamId,eventType:e},(function(o,a){o?(s.error("Error removing filter event listener to event "+e+"for Stream "+t.stream.streamId,o),401===o.code?i(new r.OpenViduError(r.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):i(o)):(delete t.handlers[e],s.info("Filter event listener to event "+e+" successfully removed on Stream "+t.stream.streamId),n())}))}))},e}();t.Filter=a},f0a5:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.ConnectionEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,t,n,i)||this;return s.connection=r,s.reason=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.ConnectionEvent=o},f1bf:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.ConnectionPropertyChangedEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i,r,o){var s=e.call(this,!1,t,"connectionPropertyChanged")||this;return s.connection=n,s.changedProperty=i,s.newValue=r,s.oldValue=o,s}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.ConnectionPropertyChangedEvent=o},f1f1:function(e,t,n){"use strict";var i=n("a21b"),r=function(e){var t,r={stun:(e||{}).stun||n("e5b5"),turn:(e||{}).turn||n("c09e")},o=(e||{}).stunCount||2,s=(e||{}).turnCount||0;function a(e,t){var n,o=[],s=[].concat(r[e]);while(s.length&&o.length<t)n=Math.random()*s.length|0,o=o.concat(s.splice(n,1));return o.map((function(t){return"string"===typeof t||t instanceof String?i(e+":"+t):t}))}return t=[].concat(a("stun",o)),s&&(t=t.concat(a("turn",s))),t};e.exports=r},f66e:function(e,t,n){"use strict";t.__esModule=!0,t.OpenViduLogger=void 0;var i=function(){function e(){this.logger=window.console,this.LOG_FNS=[this.logger.log,this.logger.debug,this.logger.info,this.logger.warn,this.logger.error],this.isProdMode=!1}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[0].apply(this.logger,arguments)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[1].apply(this.logger,arguments)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[2].apply(this.logger,arguments)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isProdMode||this.LOG_FNS[3].apply(this.logger,arguments)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.LOG_FNS[4].apply(this.logger,arguments)},e.prototype.enableProdMode=function(){this.isProdMode=!0},e}();t.OpenViduLogger=i},f852:function(e,t,n){"use strict";t.__esModule=!0,t.WebRtcStats=void 0;var i,r=n("f66e"),o=n("e237"),s=r.OpenViduLogger.getInstance(),a=function(){function e(e){this.stream=e,this.webRtcStatsEnabled=!1,this.statsInterval=1,this.stats={inbound:{audio:{bytesReceived:0,packetsReceived:0,packetsLost:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesDecoded:0,nackCount:0}},outbound:{audio:{bytesSent:0,packetsSent:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,nackCount:0}}},i=o.PlatformUtils.getInstance()}return e.prototype.isEnabled=function(){return this.webRtcStatsEnabled},e.prototype.initWebRtcStats=function(){var e=this,t=localStorage.getItem("elastest-instrumentation");if(t){s.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),this.webRtcStatsEnabled=!0;var n=JSON.parse(t);return this.statsInterval=n.webrtc.interval,s.warn("localStorage item: "+JSON.stringify(n)),void(this.webRtcStatsIntervalId=setInterval((function(){e.sendStatsToHttpEndpoint(n)}),1e3*this.statsInterval))}s.debug("WebRtc stats not enabled")},e.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),s.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},e.prototype.getSelectedIceCandidateInfo=function(){var e=this;return new Promise((function(t,n){e.getStatsAgnostic(e.stream.getRTCPeerConnection(),(function(r){if(i.isChromeBrowser()||i.isChromeMobileBrowser()||i.isOperaBrowser()||i.isOperaMobileBrowser()){var o=void 0,s=void 0,a=void 0,c={},d={};for(var u in r){var p=r[u];"localcandidate"===p.type?c[p.id]=p:"remotecandidate"===p.type?d[p.id]=p:"googCandidatePair"===p.type&&"true"===p.googActiveConnection&&(a=p,o=p.localCandidateId,s=p.remoteCandidateId)}var l=c[o];if(l){var f=e.stream.getLocalIceCandidateList(),h=f.filter((function(e){return!!e.candidate&&e.candidate.indexOf(l.ipAddress)>=0&&e.candidate.indexOf(l.portNumber)>=0&&e.candidate.indexOf(l.priority)>=0}));l.raw=h[0]?h[0].candidate:"ERROR: Cannot find local candidate in list of sent ICE candidates"}else l="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";var v=d[s];if(v){f=e.stream.getRemoteIceCandidateList(),h=f.filter((function(e){return!!e.candidate&&e.candidate.indexOf(v.ipAddress)>=0&&e.candidate.indexOf(v.portNumber)>=0&&e.candidate.indexOf(v.priority)>=0}));v.raw=h[0]?h[0].candidate:"ERROR: Cannot find remote candidate in list of received ICE candidates"}else v="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";t({googCandidatePair:a,localCandidate:l,remoteCandidate:v})}else n("Selected ICE candidate info only available for Chrome")}),(function(e){n(e)}))}))},e.prototype.sendStatsToHttpEndpoint=function(e){var t=this,n=function(n){var i=new XMLHttpRequest,r=e.webrtc.httpEndpoint;i.open("POST",r,!0),i.setRequestHeader("Content-type","application/json"),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&s.log("WebRtc stats successfully sent to "+r+" for stream "+t.stream.streamId+" of connection "+t.stream.connection.connectionId)},i.send(n)},r=function(r){if(i.isFirefoxBrowser()||i.isFirefoxMobileBrowser())r.forEach((function(i){var r={};if("inbound-rtp"===i.type&&null!==i.nackCount&&!1===i.isRemote&&i.id.startsWith("inbound")&&i.remoteId.startsWith("inbound")){var o="webrtc_inbound_"+i.mediaType+"_"+i.ssrc,s=1e3*i.jitter,a={bytesReceived:(i.bytesReceived-t.stats.inbound[i.mediaType].bytesReceived)/t.statsInterval,jitter:s,packetsReceived:(i.packetsReceived-t.stats.inbound[i.mediaType].packetsReceived)/t.statsInterval,packetsLost:(i.packetsLost-t.stats.inbound[i.mediaType].packetsLost)/t.statsInterval},c={bytesReceived:"bytes",jitter:"ms",packetsReceived:"packets",packetsLost:"packets"};"video"===i.mediaType&&(a["framesDecoded"]=(i.framesDecoded-t.stats.inbound.video.framesDecoded)/t.statsInterval,a["nackCount"]=(i.nackCount-t.stats.inbound.video.nackCount)/t.statsInterval,c["framesDecoded"]="frames",c["nackCount"]="packets",t.stats.inbound.video.framesDecoded=i.framesDecoded,t.stats.inbound.video.nackCount=i.nackCount),t.stats.inbound[i.mediaType].bytesReceived=i.bytesReceived,t.stats.inbound[i.mediaType].packetsReceived=i.packetsReceived,t.stats.inbound[i.mediaType].packetsLost=i.packetsLost,r={"@timestamp":new Date(i.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:o,stream_type:"composed_metrics",units:c},r[o]=a,n(JSON.stringify(r))}else if("outbound-rtp"===i.type&&!1===i.isRemote&&i.id.toLowerCase().includes("outbound")){o="webrtc_outbound_"+i.mediaType+"_"+i.ssrc,a={bytesSent:(i.bytesSent-t.stats.outbound[i.mediaType].bytesSent)/t.statsInterval,packetsSent:(i.packetsSent-t.stats.outbound[i.mediaType].packetsSent)/t.statsInterval},c={bytesSent:"bytes",packetsSent:"packets"};"video"===i.mediaType&&(a["framesEncoded"]=(i.framesEncoded-t.stats.outbound.video.framesEncoded)/t.statsInterval,c["framesEncoded"]="frames",t.stats.outbound.video.framesEncoded=i.framesEncoded),t.stats.outbound[i.mediaType].bytesSent=i.bytesSent,t.stats.outbound[i.mediaType].packetsSent=i.packetsSent,r={"@timestamp":new Date(i.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:o,stream_type:"composed_metrics",units:c},r[o]=a,n(JSON.stringify(r))}}));else if(i.isChromeBrowser()||i.isChromeMobileBrowser()||i.isOperaBrowser()||i.isOperaMobileBrowser())for(var o=0,s=Object.keys(r);o<s.length;o++){var a=s[o],c=r[a];if("ssrc"===c.type){var d={};if("bytesReceived"in c&&("audio"===c.mediaType&&"audioOutputLevel"in c||"video"===c.mediaType&&"qpSum"in c)){var u="webrtc_inbound_"+c.mediaType+"_"+c.ssrc,p={bytesReceived:(c.bytesReceived-t.stats.inbound[c.mediaType].bytesReceived)/t.statsInterval,jitter:c.googJitterBufferMs,packetsReceived:(c.packetsReceived-t.stats.inbound[c.mediaType].packetsReceived)/t.statsInterval,packetsLost:(c.packetsLost-t.stats.inbound[c.mediaType].packetsLost)/t.statsInterval},l={bytesReceived:"bytes",jitter:"ms",packetsReceived:"packets",packetsLost:"packets"};"video"===c.mediaType&&(p["framesDecoded"]=(c.framesDecoded-t.stats.inbound.video.framesDecoded)/t.statsInterval,p["nackCount"]=(c.googNacksSent-t.stats.inbound.video.nackCount)/t.statsInterval,l["framesDecoded"]="frames",l["nackCount"]="packets",t.stats.inbound.video.framesDecoded=c.framesDecoded,t.stats.inbound.video.nackCount=c.googNacksSent),t.stats.inbound[c.mediaType].bytesReceived=c.bytesReceived,t.stats.inbound[c.mediaType].packetsReceived=c.packetsReceived,t.stats.inbound[c.mediaType].packetsLost=c.packetsLost,d={"@timestamp":new Date(c.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:u,stream_type:"composed_metrics",units:l},d[u]=p,n(JSON.stringify(d))}else if("bytesSent"in c){u="webrtc_outbound_"+c.mediaType+"_"+c.ssrc,p={bytesSent:(c.bytesSent-t.stats.outbound[c.mediaType].bytesSent)/t.statsInterval,packetsSent:(c.packetsSent-t.stats.outbound[c.mediaType].packetsSent)/t.statsInterval},l={bytesSent:"bytes",packetsSent:"packets"};"video"===c.mediaType&&(p["framesEncoded"]=(c.framesEncoded-t.stats.outbound.video.framesEncoded)/t.statsInterval,l["framesEncoded"]="frames",t.stats.outbound.video.framesEncoded=c.framesEncoded),t.stats.outbound[c.mediaType].bytesSent=c.bytesSent,t.stats.outbound[c.mediaType].packetsSent=c.packetsSent,d={"@timestamp":new Date(c.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:u,stream_type:"composed_metrics",units:l},d[u]=p,n(JSON.stringify(d))}}}};this.getStatsAgnostic(this.stream.getRTCPeerConnection(),r,(function(e){s.log(e)}))},e.prototype.standardizeReport=function(e){s.log(e);var t={};return i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?(Object.keys(e).forEach((function(t){s.log(e[t])})),e):(e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t)},e.prototype.getStatsAgnostic=function(e,t,n){var r=this;return i.isFirefoxBrowser()||i.isFirefoxMobileBrowser()?e.getStats(null).then((function(e){var n=r.standardizeReport(e);t(n)}))["catch"](n):i.isChromeBrowser()||i.isChromeMobileBrowser()||i.isOperaBrowser()||i.isOperaMobileBrowser()?e.getStats((function(e){var n=r.standardizeReport(e);t(n)}),null,n):void 0},e}();t.WebRtcStats=a},fa28:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.__esModule=!0,t.FilterEvent=void 0;var r=n("8733"),o=function(e){function t(t,n,i){var r=e.call(this,!1,t,n)||this;return r.data=i,r}return i(t,e),t.prototype.callDefaultBehavior=function(){},t}(r.Event);t.FilterEvent=o},faa1:function(e,t,n){"use strict";var i,r="object"===typeof Reflect?Reflect:null,o=r&&"function"===typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function s(e){console&&console.warn&&console.warn(e)}i=r&&"function"===typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}e.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var d=10;function u(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function p(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var r,o,a;if(u(n),o=e._events,void 0===o?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),r=p(e),r>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s(c)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=f.bind(i);return r.listener=n,i.wrapFn=r,r}function v(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?y(r):b(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function b(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");d=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return p(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=r[e];if(void 0===c)return!1;if("function"===typeof c)o(c,this,t);else{var d=c.length,u=b(c,d);for(n=0;n<d;++n)o(u[n],this,t)}return!0},c.prototype.addListener=function(e,t){return l(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return l(this,e,t,!0)},c.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,i,r,o,s;if(u(t),i=this._events,void 0===i)return this;if(n=i[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():g(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)r=o[i],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},c.prototype.listeners=function(e){return v(this,e,!0)},c.prototype.rawListeners=function(e){return v(this,e,!1)},c.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},faac:function(e,t,n){(function(e,i){var r;
/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */(function(){"use strict";var o={function:!0,object:!0},s=o[typeof window]&&window||this,a=o[typeof t]&&t,c=o[typeof e]&&e&&!e.nodeType&&e,d=a&&c&&"object"==typeof i&&i;!d||d.global!==d&&d.window!==d&&d.self!==d||(s=d);var u=Math.pow(2,53)-1,p=/\bOpera/,l=Object.prototype,f=l.hasOwnProperty,h=l.toString;function v(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function m(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=g(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),e}function b(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=u)while(++n<i)t(e[n],n,e);else y(e,t)}function g(e){return e=R(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:v(e)}function y(e,t){for(var n in e)f.call(e,n)&&t(e[n],n,e)}function E(e){return null==e?v(e):h.call(e).slice(8,-1)}function S(e,t){var n=null!=e?typeof e[t]:"number";return!/^(?:boolean|number|string|undefined)$/.test(n)&&("object"!=n||!!e[t])}function w(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function O(e,t){var n=null;return b(e,(function(i,r){n=t(n,i,r,e)})),n}function R(e){return String(e).replace(/^ +| +$/g,"")}function C(e){var t=s,n=e&&"object"==typeof e&&"String"!=E(e);n&&(t=e,e=null);var i=t.navigator||{},r=i.userAgent||"";e||(e=r);var o,a,c=n?!!i.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(h.toString()),d="Object",u=n?d:"ScriptBridgingProxyObject",l=n?d:"Environment",f=n&&t.java?"JavaPackage":E(t.java),v=n?d:"RuntimeObject",b=/\bJava/.test(f)&&t.java,I=b&&E(t.environment)==l,P=b?"a":"",k=b?"b":"",_=t.document||{},T=t.operamini||t.opera,D=p.test(D=n&&T?T["[[Class]]"]:E(T))?D:T=null,M=e,V=[],N=null,A=e==r,L=A&&T&&"function"==typeof T.version&&T.version(),x=W([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),B=q(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=J([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),j=H({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=G(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function W(t){return O(t,(function(t,n){return t||RegExp("\\b"+(n.pattern||w(n))+"\\b","i").exec(e)&&(n.label||n)}))}function H(t){return O(t,(function(t,n,i){return t||(n[F]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+w(i)+"(?:\\b|\\w*\\d)","i").exec(e))&&i}))}function q(t){return O(t,(function(t,n){return t||RegExp("\\b"+(n.pattern||w(n))+"\\b","i").exec(e)&&(n.label||n)}))}function G(t){return O(t,(function(t,n){var i=n.pattern||w(n);return!t&&(t=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=m(t,i,n.label||n)),t}))}function J(t){return O(t,(function(t,n){var i=n.pattern||w(n);return!t&&(t=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(e)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=g(t[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t}))}function z(t){return O(t,(function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null}))}function $(){return this.description||""}if(x&&(x=[x]),/\bAndroid\b/.test(U)&&!F&&(o=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(e))&&(F=R(o[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),j&&!F?F=J([j]):j&&F&&(F=F.replace(RegExp("^("+w(j)+")[-_.\\s]","i"),j+" ").replace(RegExp("^("+w(j)+")[-_.]?(\\w)","i"),j+" $2")),(o=/\bGoogle TV\b/.exec(F))&&(F=o[0]),/\bSimulator\b/i.test(e)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==B&&/\bOPiOS\b/.test(e)&&V.push("running in Turbo/Uncompressed mode"),"IE"==B&&/\blike iPhone OS\b/.test(e)?(o=C(e.replace(/like iPhone OS/,"")),j=o.manufacturer,F=o.product):/^iP/.test(F)?(B||(B="Safari"),U="iOS"+((o=/ OS ([\d_]+)/i.exec(e))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"==B&&/^Linux\b/i.test(U)?U="Kubuntu":j&&"Google"!=j&&(/Chrome/.test(B)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(F))||/\bAndroid\b/.test(U)&&/^Chrome/.test(B)&&/\bVersion\//i.test(e)?(B="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==B?(/\bMobi/i.test(e)||(U="Android",V.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&V.unshift("accelerated")):"UC Browser"==B&&/\bUCWEB\b/.test(e)?V.push("speed mode"):"PaleMoon"==B&&(o=/\bFirefox\/([\d.]+)\b/.exec(e))?V.push("identifying as Firefox "+o[1]):"Firefox"==B&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(U||(U="Firefox OS"),F||(F=o[1])):!B||(o=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(B))?(B&&!F&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(o+"/")+8))&&(B=null),(o=F||j||U)&&(F||j||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(B=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:o)+" Browser")):"Electron"==B&&(o=(/\bChrome\/([\d.]+)\b/.exec(e)||0)[1])&&V.push("Chromium "+o),L||(L=z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",w(B),"(?:Firefox|Minefield|NetFront)"])),(o=("iCab"==x&&parseFloat(L)>3?"WebKit":/\bOpera\b/.test(B)&&(/\bOPR\b/.test(e)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(x)&&"WebKit"||!x&&/\bMSIE\b/i.test(e)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==x&&/\bPlayStation\b(?! Vita\b)/i.test(B)&&"NetFront")&&(x=[o]),"IE"==B&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(B+=" Mobile",U="Windows Phone "+(/\+$/.test(o)?o:o+".x"),V.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(B="IE Mobile",U="Windows Phone 8.x",V.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=B&&"Trident"==x&&(o=/\brv:([\d.]+)/.exec(e))&&(B&&V.push("identifying as "+B+(L?" "+L:"")),B="IE",L=o[1]),A){if(S(t,"global"))if(b&&(o=b.lang.System,M=o.getProperty("os.arch"),U=U||o.getProperty("os.name")+" "+o.getProperty("os.version")),I){try{L=t.require("ringo/engine").version.join("."),B="RingoJS"}catch(Y){(o=t.system)&&o.global.system==t.system&&(B="Narwhal",U||(U=o[0].os||null))}B||(B="Rhino")}else"object"==typeof t.process&&!t.process.browser&&(o=t.process)&&("object"==typeof o.versions&&("string"==typeof o.versions.electron?(V.push("Node "+o.versions.node),B="Electron",L=o.versions.electron):"string"==typeof o.versions.nw&&(V.push("Chromium "+L,"Node "+o.versions.node),B="NW.js",L=o.versions.nw)),B||(B="Node.js",M=o.arch,U=o.platform,L=/[\d.]+/.exec(o.version),L=L?L[0]:null));else E(o=t.runtime)==u?(B="Adobe AIR",U=o.flash.system.Capabilities.os):E(o=t.phantom)==v?(B="PhantomJS",L=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof _.documentMode&&(o=/\bTrident\/(\d+)/i.exec(e))?(L=[L,_.documentMode],(o=+o[1]+4)!=L[1]&&(V.push("IE "+L[1]+" mode"),x&&(x[1]=""),L[1]=o),L="IE"==B?String(L[1].toFixed(1)):L[0]):"number"==typeof _.documentMode&&/^(?:Chrome|Firefox)\b/.test(B)&&(V.push("masking as "+B+" "+L),B="IE",L="11.0",x=["Trident"],U="Windows");U=U&&g(U)}if(L&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(A&&i.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(N=/b/i.test(o)?"beta":"alpha",L=L.replace(RegExp(o+"\\+?$"),"")+("beta"==N?k:P)+(/\d+\+?/.exec(o)||"")),"Fennec"==B||"Firefox"==B&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))B="Firefox Mobile";else if("Maxthon"==B&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(U=null),"Xbox 360"==F&&/\bIEMobile\b/.test(e)&&V.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(B)&&(!B||F||/Browser|Mobi/.test(B))||"Windows CE"!=U&&!/Mobi/i.test(e))if("IE"==B&&A)try{null===t.external&&V.unshift("platform preview")}catch(Y){V.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(e))&&(o=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||L)?(o=[o,/BB10/.test(e)],U=(o[1]?(F=null,j="BlackBerry"):"Device Software")+" "+o[0],L=null):this!=y&&"Wii"!=F&&(A&&T||/Opera/.test(B)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==B&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==B&&(U&&!/^Win/.test(U)&&L>5.5||/\bWindows XP\b/.test(U)&&L>8||8==L&&!/\bTrident\b/.test(e)))&&!p.test(o=C.call(y,e.replace(p,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),p.test(B)?(/\bIE\b/.test(o)&&"Mac OS"==U&&(U=null),o="identify"+o):(o="mask"+o,B=D?g(D.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(U=null),A||(L=null)),x=["Presto"],V.push(o));else B+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==B&&"+"==o[1].slice(-1)?(B="WebKit Nightly",N="alpha",L=o[1].slice(0,-1)):L!=o[1]&&L!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(L=null),o[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(e)||0)[1],537.36==o[0]&&537.36==o[2]&&parseFloat(o[1])>=28&&"WebKit"==x&&(x=["Blink"]),A&&(c||o[1])?(x&&(x[1]="like Chrome"),o=o[1]||(o=o[0],o<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=x?"27":"28")):(x&&(x[1]="like Safari"),o=o[0],o=o<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:o<602?9:o<604?10:o<606?11:o<608?12:"12"),x&&(x[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==B&&(!L||parseInt(L)>45)?L=o:"Chrome"==B&&/\bHeadlessChrome/i.test(e)&&V.unshift("headless")),"Opera"==B&&(o=/\bzbov|zvav$/.exec(U))?(B+=" ",V.unshift("desktop mode"),"zvav"==o?(B+="Mini",L=null):B+="Mobile",U=U.replace(RegExp(" *"+o+"$"),"")):"Safari"==B&&/\bChrome\b/.exec(x&&x[1])?(V.unshift("desktop mode"),B="Chrome Mobile",L=null,/\bOS X\b/.test(U)?(j="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(B)&&!L&&(L=z("Chrome")),L&&0==L.indexOf(o=/[\d.]+$/.exec(U))&&e.indexOf("/"+o+"-")>-1&&(U=R(U.replace(o,""))),U&&-1!=U.indexOf(B)&&!RegExp(B+" OS").test(U)&&(U=U.replace(RegExp(" *"+w(B)+" *"),"")),x&&!/\b(?:Avant|Nook)\b/.test(B)&&(/Browser|Lunascape|Maxthon/.test(B)||"Safari"!=B&&/^iOS/.test(U)&&/\bSafari\b/.test(x[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(B)&&x[1])&&(o=x[x.length-1])&&V.push(o),V.length&&(V=["("+V.join("; ")+")"]),j&&F&&F.indexOf(j)<0&&V.push("on "+j),F&&V.push((/^on /.test(V[V.length-1])?"":"on ")+F),U&&(o=/ ([\d.+]+)$/.exec(U),a=o&&"/"==U.charAt(U.length-o[0].length-1),U={architecture:32,family:o&&!a?U.replace(o[0],""):U,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!a?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(M))&&!/\bi686\b/i.test(M)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+o),"")),B&&(/\bWOW64\b/i.test(e)||A&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(e))&&V.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==B&&parseFloat(L)>=39&&(U.architecture=64),e||(e=null);var X={};return X.description=e,X.layout=x&&x[0],X.manufacturer=j,X.name=B,X.prerelease=N,X.product=F,X.ua=e,X.version=B&&L,X.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},X.parse=C,X.toString=$,X.version&&V.unshift(L),X.name&&V.unshift(B),U&&B&&(U!=String(U).split(" ")[0]||U!=B.split(" ")[0]&&!F)&&V.push(F?"("+U+")":"on "+U),V.length&&(X.description=V.join(" ")),X}var I=C();s.platform=I,r=function(){return I}.call(t,n,t,e),void 0===r||(e.exports=r)}).call(this)}).call(this,n("62e4")(e),n("c8ba"))},fb6e:function(e,t){function n(e,t,n){var i={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return n&&(i.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(i.video.mandatory.chromeMediaSourceId=t,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=t)),i}function i(e){r?r.isLoaded?e?e.forEach?r.contentWindow.postMessage({captureCustomSourceId:e},"*"):r.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):r.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){i(e)}),100):o((function(){i(e)}))}var r;function o(e){r?e():(r=document.createElement("iframe"),r.onload=function(){r.isLoaded=!0,e()},r.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",r.style.display="none",(document.body||document.documentElement).appendChild(r))}function s(){r?r.isLoaded?r.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(s,100):o(s)}window.getScreenId=function(e,t,r){function o(e){e.data&&(e.data.chromeMediaSourceId&&("PermissionDeniedError"===e.data.chromeMediaSourceId?t("permission-denied"):t(null,e.data.chromeMediaSourceId,n(null,e.data.chromeMediaSourceId,e.data.canRequestAudioTrack)),window.removeEventListener("message",o)),e.data.chromeExtensionStatus&&(t(e.data.chromeExtensionStatus,null,n(e.data.chromeExtensionStatus)),window.removeEventListener("message",o)))}-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?t(null,"firefox",{video:{mozMediaSource:e,mediaSource:e}}):(window.addEventListener("message",o),r?setTimeout((function(){i(r)}),100):setTimeout(i,100)):t({video:!0})},window.getScreenConstraints=function(e){o((function(){getScreenId((function(t,n,i){i||(i={video:!0}),e(t,i.video)}))}))},window.getChromeExtensionStatus=function(e){function t(n){n.data&&n.data.chromeExtensionStatus&&(e(n.data.chromeExtensionStatus),window.removeEventListener("message",t))}navigator.mozGetUserMedia?e("installed-enabled"):(window.addEventListener("message",t),setTimeout(s,100))},t.getScreenId=getScreenId},fdd2:function(e,t,n){"use strict";t.__esModule=!0,t.VideoInsertMode=void 0,function(e){e["AFTER"]="AFTER",e["APPEND"]="APPEND",e["BEFORE"]="BEFORE",e["PREPEND"]="PREPEND",e["REPLACE"]="REPLACE"}(t.VideoInsertMode||(t.VideoInsertMode={}))}}]);